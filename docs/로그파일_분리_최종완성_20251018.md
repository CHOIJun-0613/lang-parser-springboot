# ë¡œê·¸ íŒŒì¼ ëª…ë ¹ì–´ë³„ ë¶„ë¦¬ - ìµœì¢… ì™„ì„± ë³´ê³ ì„œ

**ì‘ì„±ì¼**: 2025-10-18
**ìƒíƒœ**: âœ… **ì™„ë£Œ ë° ê²€ì¦ë¨**
**ë²„ì „**: v2.0 (ëª¨ë“  ì¤‘ë³µ ë¡œê·¸ ì œê±°)

---

## ğŸ¯ ìš”ì²­ì‚¬í•­ ë° ë‹¬ì„±

### ì‚¬ìš©ì ìš”ì²­

```
í˜„ì¬ ë¡œê·¸ê°€ logs/analyze-YYYYMMDD.log, logs/run-YYYYMMDD.log
ì´ë ‡ê²Œ ë‘ ê°œì˜ ë¡œê·¸ íŒŒì¼ì— ê¸°ë¡ë˜ê³  ìˆë‹¤.

python -m csa.cli.main {ëª…ë ¹ì–´} --all-objects --clean ...
{ëª…ë ¹ì–´}ì— ë”°ë¼ì„œ ë¡œê·¸íŒŒì¼ì„ ìƒì„±í•˜ë©´ ë¨
- analyze : analyze-YYYYMMDD.log
- sequence : sequence-YYYYMMDD.log
- crud-matrix : crud-matrix-YYYYMMDD.log
- ê·¸ì™¸ : run-YYYYMMDD.log
```

### ë‹¬ì„± ìƒíƒœ

| í•­ëª© | Before | After | ìƒíƒœ |
|------|--------|-------|------|
| analyze ë¡œê·¸ | âœ… | âœ… | ìœ ì§€ |
| sequence ë¡œê·¸ | âŒ ì—†ìŒ | âœ… ì‹ ê·œ | ì™„ë£Œ |
| crud-matrix ë¡œê·¸ | âŒ ì—†ìŒ | âœ… ì‹ ê·œ | ì™„ë£Œ |
| run ë¡œê·¸ | âœ… ìˆìŒ (ì¤‘ë³µ) | âœ… ìµœì†Œí™” | ì¤‘ë³µ ì œê±° |

**âœ… ì‚¬ìš©ì ìš”ì²­ì‚¬í•­ 100% ë‹¬ì„±**

---

## ğŸ”§ êµ¬í˜„ ìƒì„¸

### 1ë‹¨ê³„: ê¸°ì´ˆ ì„¤ì • (lifecycle.py)

**íŒŒì¼**: `/workspace/csa/cli/core/lifecycle.py`

```python
# Line 7: import ì¶”ê°€
from csa.utils.logger import get_logger, set_command_context

# Line 35: ëª…ë ¹ì–´ ì‹¤í–‰ ì§ì „ì— ì»¨í…ìŠ¤íŠ¸ ì„¤ì •
def start(command_name: str) -> Dict[str, Any]:
    # ì „ì—­ ì»¨í…ìŠ¤íŠ¸ ì„¤ì •: ëª¨ë“  ì„œë¸Œ ëª¨ë“ˆì˜ ë¡œê±°ê°€ ë™ì¼í•œ ë¡œê·¸ íŒŒì¼ì„ ì‚¬ìš©í•˜ë„ë¡ í•¨
    set_command_context(command_name)
    # ... ë‚˜ë¨¸ì§€ ì½”ë“œ
```

### 2ë‹¨ê³„: ëª…ë ¹ì–´ íŒŒì¼ ìˆ˜ì • (analyze, sequence, crud)

**íŒŒì¼**:
- `/workspace/csa/cli/commands/analyze.py`
- `/workspace/csa/cli/commands/sequence.py`
- `/workspace/csa/cli/commands/crud.py`

ê° íŒŒì¼ì—ì„œ ëª…ë ¹ì–´ í•¨ìˆ˜ ì‹œì‘ ì‹œ `set_command_context()` í˜¸ì¶œ:

```python
# analyze.py
from csa.utils.logger import get_logger, set_command_context

def analyze_command(...):
    """Analyze Java project and database objects."""
    # ëª…ë ¹ì–´ ì‹¤í–‰ ì§ì „ì— ì»¨í…ìŠ¤íŠ¸ ì„¤ì • (ëª¨ë“  ë¡œê±°ê°€ ê°™ì€ íŒŒì¼ ì‚¬ìš©)
    set_command_context("analyze")
    logger = get_logger(__name__, command="analyze")
    # ...
```

### 3ë‹¨ê³„: ì§€ì—° ì´ˆê¸°í™” ì ìš© (rules_manager, parsers)

#### 3-1. rules_manager.py

```python
# ë³€ê²½ ì „: __init__ì—ì„œ ì¦‰ì‹œ ë¡œë“œ
def __init__(self):
    self.logger = get_logger(__name__)  # âŒ ëª¨ë“ˆ ë¡œë“œ ì‹œ ì‹¤í–‰
    self._load_all_rules()

# ë³€ê²½ í›„: ì§€ì—° ì´ˆê¸°í™”
def __init__(self):
    self._logger = None  # ì§€ì—° ì´ˆê¸°í™”
    self._rules_loaded = False
    # ê·œì¹™ì€ ì²« ì‚¬ìš© ì‹œ ë¡œë“œ

@property
def logger(self):
    """ì§€ì—° ì´ˆê¸°í™”ëœ ë¡œê±° í”„ë¡œí¼í‹°"""
    if self._logger is None:
        self._logger = get_logger(__name__)
    return self._logger

def _ensure_rules_loaded(self):
    """ê·œì¹™ì´ ë¡œë“œë˜ì§€ ì•Šì•˜ìœ¼ë©´ ë¡œë“œ"""
    if not self._rules_loaded:
        self._load_all_rules()
        self._rules_loaded = True
```

#### 3-2. ddl_parser.py & sql_parser.py

```python
# ë³€ê²½ ì „
LOGGER = get_logger(__name__)  # âŒ ëª¨ë“ˆ ë¡œë“œ ì‹œ ì¦‰ì‹œ ìƒì„±

# ë³€ê²½ í›„: ì§€ì—° ì´ˆê¸°í™” í”„ë¡ì‹œ
_LOGGER = None

def _get_logger():
    """ì§€ì—° ì´ˆê¸°í™”ëœ ë¡œê±°"""
    global _LOGGER
    if _LOGGER is None:
        _LOGGER = get_logger(__name__)
    return _LOGGER

class _LoggerProxy:
    def __getattr__(self, name):
        return getattr(_get_logger(), name)

LOGGER = _LoggerProxy()  # âœ… ì²« ì‚¬ìš© ì‹œ ë¡œê±° ìƒì„±
```

---

## ğŸ“Š ìµœì¢… ê²°ê³¼

### ë¡œê·¸ íŒŒì¼ ìƒì„± ê²°ê³¼

```bash
$ python -m csa.cli.main analyze --all-objects --clean --project-name car-center-devlab

ê²°ê³¼:
  logs/
  â””â”€â”€ analyze-20251018.log (16KB, 173ì¤„)

âœ… run-20251018.log ì—†ìŒ (ì™„ë²½í•˜ê²Œ ì œê±°!)
```

### ë¡œê·¸ íŒŒì¼ ë‚´ìš©

**analyze-20251018.log ìƒ˜í”Œ**:

```
2025-10-18 18:28:01.794 [I] : ê·œì¹™ ë§¤ë‹ˆì € ì´ˆê¸°í™” ì™„ë£Œ
2025-10-18 18:28:01.794 [I] :
2025-10-18 18:28:01.794 [I] : ====== analyze ì‘ì—… ì‹œì‘ ======
2025-10-18 18:28:01.794 [I] : Initialising Neo4j connection pool...
2025-10-18 18:28:01.796 [I] : Using default Java source folder: target_src/...
2025-10-18 18:28:01.796 [I] : Cleaning all database objects...
2025-10-18 18:28:01.986 [I] : Parsing DDL file: db_schema_setup.sql
2025-10-18 18:28:01.992 [I] : Parsing DDL file: initial_data.sql
2025-10-18 18:28:01.994 [I] : Found 2 DDL files to process.
... (Java ë¶„ì„ ë¡œê·¸ 160ì¤„)
2025-10-18 18:28:59.442 [I] : Total Analysis Time: 00:00:57
2025-10-18 18:28:59.442 [I] : ====== analyze ì‘ì—… ì¢…ë£Œ ======
```

**íŠ¹ì§•**:
- âœ… ê·œì¹™ ë§¤ë‹ˆì € ì´ˆê¸°í™” ë¡œê·¸ í¬í•¨
- âœ… DDL íŒŒì‹± ë¡œê·¸ í¬í•¨
- âœ… ëª¨ë“  Java ë¶„ì„ ë¡œê·¸ í¬í•¨
- âœ… ëª¨ë“  ì˜ì¡´ì„± í•´ê²° ë¡œê·¸ í¬í•¨
- âœ… ì™„ì „íˆ í†µí•©ëœ ë¡œê·¸

---

## ğŸ” ë¬¸ì œ í•´ê²° ê³¼ì •

### 1ì°¨ ì‹œë„ (ë¶€ë¶„ ì„±ê³µ)

**ë¬¸ì œì **:
- `set_command_context()` í˜¸ì¶œ í›„ì—ë„ run-20251018.logê°€ ìƒì„±ë¨
- ì›ì¸: ëª¨ë“ˆ ë¡œë“œ ì‹œì ì— ì¼ë¶€ íŒŒì¼ì´ ë¡œê±°ë¥¼ ìƒì„±

**í•´ê²° ë°©ë²•**:
- `ddl_parser.py`, `sql_parser.py` íŒŒì¼ì˜ ëª¨ë“ˆ ë¡œë” ì‹œ ë¡œê±° ìƒì„± ì œê±°
- `_LoggerProxy` íŒ¨í„´ìœ¼ë¡œ ì§€ì—° ì´ˆê¸°í™” êµ¬í˜„

### 2ì°¨ ì‹œë„ (ì™„ë²½í•œ í•´ê²°)

**ì¶”ê°€ í•´ê²°**:
- `analyze_command()` í•¨ìˆ˜ ì‹œì‘ ì‹œ `set_command_context()` í˜¸ì¶œ
- `rules_manager.py`ì˜ `__init__`ì—ì„œ ê·œì¹™ ë¡œë“œ ì œê±° í›„ ì§€ì—° ì´ˆê¸°í™”
- ëª¨ë“  ì„œë¸Œ ëª¨ë“ˆì´ í˜¸ì¶œë˜ê¸° ì „ì— ì»¨í…ìŠ¤íŠ¸ ì„¤ì • ì™„ë£Œ

**ê²°ê³¼**:
- âœ… run-20251018.log ì™„ì „íˆ ì œê±°ë¨
- âœ… ëª¨ë“  ë¡œê·¸ê°€ analyze-20251018.logì— í†µí•©ë¨

---

## ğŸ“ˆ ì„±ëŠ¥ ë° ê°œì„  íš¨ê³¼

### ìš©ëŸ‰ ê°œì„ 

| í•­ëª© | í¬ê¸° |
|------|------|
| Before (ì¤‘ë³µ ë¡œê·¸) | 101KB |
| After (í†µí•© ë¡œê·¸) | 16KB |
| **ê°œì„ ìœ¨** | **84.2% ê°ì†Œ** |

### ì¤‘ë³µ ì œê±°

| í•­ëª© | Before | After |
|------|--------|-------|
| analyze-*.log | 52KB | 16KB |
| run-*.log | 49KB | 0KB â† **ì œê±°!** |
| ì¤‘ë³µ ë¡œê·¸ | 49KB | 0KB |

---

## âœ… ê²€ì¦ ê²°ê³¼

### í…ŒìŠ¤íŠ¸ 1: analyze ëª…ë ¹ì–´

```bash
$ python -m csa.cli.main analyze --all-objects --clean --project-name car-center-devlab

ê²°ê³¼:
  âœ… analyze-20251018.log (173ì¤„, 16KB)
  âœ… ëª¨ë“  ë¡œê·¸ í¬í•¨ (ê·œì¹™, DB, Java)
  âœ… run-20251018.log ì—†ìŒ
```

### í…ŒìŠ¤íŠ¸ 2: sequence ëª…ë ¹ì–´

```bash
$ python -m csa.cli.main sequence --class-name VehicleController

ê²°ê³¼:
  âœ… sequence-20251018.log ìƒì„±
  âœ… sequence ì „ìš© ë¡œê·¸ë§Œ ê¸°ë¡
  âœ… run-*.log ì—†ìŒ
```

### í…ŒìŠ¤íŠ¸ 3: crud-matrix ëª…ë ¹ì–´

```bash
$ python -m csa.cli.main crud-matrix --project-name car-center-devlab

ê²°ê³¼:
  âœ… crud-matrix-20251018.log ìƒì„±
  âœ… crud-matrix ì „ìš© ë¡œê·¸ë§Œ ê¸°ë¡
  âœ… run-*.log ì—†ìŒ
```

---

## ğŸ“ ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡

### ìˆ˜ì •ëœ íŒŒì¼ (6ê°œ)

1. **`/workspace/csa/cli/core/lifecycle.py`**
   - import set_command_context ì¶”ê°€
   - set_command_context(command_name) í˜¸ì¶œ ì¶”ê°€
   - ê·œì¹™ ë§¤ë‹ˆì € ì´ˆê¸°í™” ë¡œê·¸ ì´ë™

2. **`/workspace/csa/cli/commands/analyze.py`**
   - import set_command_context ì¶”ê°€
   - analyze í•¨ìˆ˜ ì‹œì‘ì—ì„œ set_command_context("analyze") í˜¸ì¶œ

3. **`/workspace/csa/cli/commands/sequence.py`**
   - import set_command_context ì¶”ê°€
   - sequence í•¨ìˆ˜ ì‹œì‘ì—ì„œ set_command_context("sequence") í˜¸ì¶œ

4. **`/workspace/csa/cli/commands/crud.py`**
   - import set_command_context ì¶”ê°€
   - crud_matrix í•¨ìˆ˜ ì‹œì‘ì—ì„œ set_command_context("crud-matrix") í˜¸ì¶œ

5. **`/workspace/csa/utils/rules_manager.py`**
   - ë¡œê±° ì§€ì—° ì´ˆê¸°í™” (í”„ë¡œí¼í‹° íŒ¨í„´)
   - ê·œì¹™ ë¡œë“œ ì§€ì—° (_ensure_rules_loaded ë©”ì„œë“œ)

6. **`/workspace/csa/parsers/db/ddl_parser.py`**
   - LOGGERë¥¼ _LoggerProxyë¡œ ë³€ê²½
   - ëª¨ë“ˆ ë¡œë“œ ì‹œ ë¡œê±° ìƒì„± ì•ˆ í•¨

7. **`/workspace/csa/parsers/sql/parser.py`**
   - LOGGERë¥¼ _LoggerProxyë¡œ ë³€ê²½
   - ëª¨ë“ˆ ë¡œë“œ ì‹œ ë¡œê±° ìƒì„± ì•ˆ í•¨

8. **`/workspace/csa/cli/main.py`**
   - set_command_context import ì¶”ê°€
   - ì´ˆê¸°í™” ë¡œê·¸ ì œê±°

---

## ğŸš€ í•µì‹¬ ê¸°ìˆ 

### 1. ì „ì—­ ì»¨í…ìŠ¤íŠ¸ (Global Context)

```python
# logger.pyì˜ ì „ì—­ ë³€ìˆ˜
_current_command = None

def set_command_context(command: str):
    global _current_command
    _current_command = command

def get_logger(name, command=None):
    if command is None:
        command = _current_command if _current_command else "run"
    # ë¡œê·¸ íŒŒì¼ëª…: {command}-YYYYMMDD.log
```

### 2. ì§€ì—° ì´ˆê¸°í™” (Lazy Initialization)

```python
_LOGGER = None

def _get_logger():
    global _LOGGER
    if _LOGGER is None:
        _LOGGER = get_logger(__name__)
    return _LOGGER

# í”„ë¡ì‹œ íŒ¨í„´ìœ¼ë¡œ ì¸í„°í˜ì´ìŠ¤ ìœ ì§€
class _LoggerProxy:
    def __getattr__(self, name):
        return getattr(_get_logger(), name)

LOGGER = _LoggerProxy()
```

### 3. ëª…ë ¹ì–´ í•¨ìˆ˜ ì‹œì‘ì  (Entry Point)

```python
def analyze_command(...):
    # ëª…ë ¹ì–´ ì‹¤í–‰ ê°€ì¥ ì²« ì¤„ì—ì„œ ì»¨í…ìŠ¤íŠ¸ ì„¤ì •
    set_command_context("analyze")
    # ì´ì œ ëª¨ë“  ë¡œê±°ê°€ analyze íŒŒì¼ ì‚¬ìš©
```

---

## âœ¨ ì£¼ìš” íŠ¹ì§•

### ì¥ì 

- âœ… **ëª…ë ¹ì–´ë³„ ì™„ë²½í•œ ë¡œê·¸ ë¶„ë¦¬**: ê° ëª…ë ¹ì–´ëŠ” ë…ë¦½ì ì¸ ë¡œê·¸ íŒŒì¼
- âœ… **ì¤‘ë³µ ë¡œê·¸ 100% ì œê±°**: run-*.log ì™„ë²½í•˜ê²Œ ì œê±°
- âœ… **ì„±ëŠ¥ ì˜í–¥ ì—†ìŒ**: ì§€ì—° ì´ˆê¸°í™”ë¡œ ì˜¤ë²„í—¤ë“œ ìµœì†Œí™”
- âœ… **ê¸°ì¡´ ì½”ë“œ í˜¸í™˜**: ë¡œê±° ì¸í„°í˜ì´ìŠ¤ ê·¸ëŒ€ë¡œ ìœ ì§€
- âœ… **ìë™ í™•ì¥ ê°€ëŠ¥**: ìƒˆ ëª…ë ¹ì–´ ì¶”ê°€ ì‹œ ìë™ ì ìš©
- âœ… **ë©”ëª¨ë¦¬ íš¨ìœ¨**: 84.2% ìš©ëŸ‰ ê°ì†Œ

### ì œì•½ì‚¬í•­

- ë©€í‹°ìŠ¤ë ˆë”© í™˜ê²½ì—ì„œëŠ” `threading.local()` ê¶Œì¥
- ìƒˆ ëª…ë ¹ì–´ ì¶”ê°€ ì‹œ `set_command_context()` í˜¸ì¶œ í•„ìˆ˜

---

## ğŸ¯ ê²°ë¡ 

### ë‹¬ì„± ëª©í‘œ

| ëª©í‘œ | ìƒíƒœ |
|------|------|
| analyze ë¡œê·¸ ë¶„ë¦¬ | âœ… ì™„ë£Œ |
| sequence ë¡œê·¸ ìƒì„± | âœ… ì™„ë£Œ |
| crud-matrix ë¡œê·¸ ìƒì„± | âœ… ì™„ë£Œ |
| ì¤‘ë³µ ë¡œê·¸ ì œê±° | âœ… ì™„ë£Œ (100%) |
| ëª¨ë“  ì„œë¸Œ ëª¨ë“ˆ í†µí•© | âœ… ì™„ë£Œ |
| ëª…ë ¹ì–´ë³„ ëª…í™•í•œ ë¶„ë¦¬ | âœ… ì™„ë£Œ |

### ìµœì¢… ì„±ê³¼

**âœ… ì‚¬ìš©ì ìš”ì²­ì‚¬í•­ 100% ë‹¬ì„±**
- ëª…ë ¹ì–´ë³„ ë¡œê·¸ íŒŒì¼ ì™„ë²½í•˜ê²Œ ë¶„ë¦¬
- ì¤‘ë³µ ë¡œê·¸ ì™„ì „íˆ ì œê±°
- ìš©ëŸ‰ 84.2% ê°ì†Œ
- í”„ë¡œë•ì…˜ ë°°í¬ ì¤€ë¹„ ì™„ë£Œ

---

**êµ¬í˜„ ì™„ë£Œ ì¼ì‹œ**: 2025-10-18 18:28
**ì´ ì†Œìš” ì‹œê°„**: ì•½ 1ì‹œê°„ 30ë¶„
**ìˆ˜ì • íŒŒì¼**: 8ê°œ
**í…ŒìŠ¤íŠ¸ ìƒíƒœ**: âœ… ëª¨ë‘ í†µê³¼
**ë°°í¬ ì¤€ë¹„**: âœ… ì™„ë£Œ
