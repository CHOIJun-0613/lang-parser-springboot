# ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ ìƒì„± ë¡œì§ ê°œì„  (2025-10-19)

## ê°œìš”

ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ ìƒì„± ë¡œì§ì˜ ì •í™•ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„±ì„ ê°œì„ í•˜ê¸° ìœ„í•´ ë‹¤ìŒ ì‚¬í•­ë“¤ì„ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤:

1. ì™¸ë¶€ í´ë˜ìŠ¤ ì œì™¸ ë¡œì§ ê°œì„ 
2. Database Table í‘œì‹œ í˜•ì‹ ê°œì„ 
3. ë©”ì„œë“œ í˜¸ì¶œ ìˆœì„œ ë° ë¦¬í„´ ìœ„ì¹˜ ì •í™•ì„± ê°œì„ 
4. Mermaidì™€ PlantUML ê³µí†µ ì¿¼ë¦¬ ë¶„ë¦¬ í™•ì¸

## ìˆ˜ì • ìš°ì„ ìˆœìœ„

- **1ìˆœìœ„**: Mermaid í¬ë§·
- **2ìˆœìœ„**: PlantUML í¬ë§·
- **ìµœì¢…ëª©í‘œ**: Mermaidì™€ PlantUML í¬ë§·ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì¿¼ë¦¬ ì¤‘ ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì¿¼ë¦¬ëŠ” ë³„ë„ ì½”ë“œ íŒŒì¼ë¡œ ë¶„ë¦¬í•´ì„œ ê° ì½”ë“œì—ì„œ í˜¸ì¶œí•´ì„œ ì‚¬ìš©

## ì£¼ìš” ìˆ˜ì • ì‚¬í•­

### 1. ì™¸ë¶€ í´ë˜ìŠ¤ ì œì™¸ ë¡œì§ ê°œì„ 

**íŒŒì¼**: `csa/diagrams/sequence/repository.py`

**ìˆ˜ì • ë‚´ìš©**:
- `_safe_project` í•¨ìˆ˜ì— ìƒì„¸í•œ docstring ì¶”ê°€
- `_should_include_method` í•¨ìˆ˜ì— ì™¸ë¶€ í´ë˜ìŠ¤ ì œì™¸ ê·œì¹™ ëª…ì‹œ

**ë³€ê²½ ì „**:
```python
def _safe_project(value: Optional[str]) -> Optional[str]:
    if value is None:
        return None
    lowered = value.strip()
    if not lowered or lowered.lower() == "null":
        return None
    return lowered

def _should_include_method(target_project: Optional[str]) -> bool:
    project = _safe_project(target_project)
    if project is None:
        return False
    if project_name is None:
        return True
    return project == project_name
```

**ë³€ê²½ í›„**:
```python
def _safe_project(value: Optional[str]) -> Optional[str]:
    """í”„ë¡œì íŠ¸ëª…ì„ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•©ë‹ˆë‹¤. ë¹ˆ ë¬¸ìì—´, None, 'null' ë¬¸ìì—´ì€ Noneìœ¼ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤."""
    if value is None:
        return None
    lowered = value.strip()
    if not lowered or lowered.lower() == "null":
        return None
    return lowered

def _should_include_method(target_project: Optional[str]) -> bool:
    """ë©”ì„œë“œ í˜¸ì¶œì„ í¬í•¨í• ì§€ ê²°ì •í•©ë‹ˆë‹¤.

    ì™¸ë¶€ í´ë˜ìŠ¤ ì œì™¸ ê·œì¹™:
    - target_projectê°€ ë¹ˆ ë¬¸ìì—´(""), None, "null"ì¸ ê²½ìš° ì œì™¸ (False ë°˜í™˜)
    - project_nameì´ ì§€ì •ë˜ì§€ ì•Šì€ ê²½ìš° ëª¨ë“  í”„ë¡œì íŠ¸ í¬í•¨ (True ë°˜í™˜)
    - target_projectì™€ project_nameì´ ì¼ì¹˜í•˜ëŠ” ê²½ìš°ë§Œ í¬í•¨ (True ë°˜í™˜)
    """
    project = _safe_project(target_project)
    # í”„ë¡œì íŠ¸ëª…ì´ ì—†ëŠ” ì™¸ë¶€ í´ë˜ìŠ¤ëŠ” ì œì™¸
    if project is None:
        return False
    # í•„í„°ë§í•  project_nameì´ ì—†ìœ¼ë©´ ëª¨ë“  í”„ë¡œì íŠ¸ í¬í•¨
    if project_name is None:
        return True
    # í”„ë¡œì íŠ¸ëª…ì´ ì¼ì¹˜í•˜ëŠ” ê²½ìš°ë§Œ í¬í•¨
    return project == project_name
```

**ê°œì„  íš¨ê³¼**:
- project_nameì´ ë¹ˆ ë¬¸ìì—´(""), None, "null"ì¸ ì™¸ë¶€ í´ë˜ìŠ¤ë¥¼ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ ì œì™¸
- ë‹¨, Database Tableì€ ì—¬ëŸ¬ í”„ë¡œì íŠ¸ì—ì„œ ê³µìœ ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ í¬í•¨

### 2. Database Table Schema ë°˜í™˜ ë¡œì§ ê°œì„ 

**íŒŒì¼**: `csa/diagrams/sequence/repository.py`

**ìˆ˜ì • ë‚´ìš©**:
- `get_table_schema` í•¨ìˆ˜ë¥¼ ìˆ˜ì •í•˜ì—¬ schemaë§Œ ë°˜í™˜í•˜ë„ë¡ ë³€ê²½
- Table ë…¸ë“œê°€ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ schemaê°€ ë¹ˆ ë¬¸ìì—´ì¸ ê²½ìš° ë¹ˆ ë¬¸ìì—´ ë°˜í™˜
- Table participant í‘œì‹œ í˜•ì‹ì„ "schema.table"ë¡œ í†µì¼

**ë³€ê²½ ì „**:
```python
def get_table_schema(session, table_name: str, project_name: Optional[str]) -> str:
    """Resolve table schema information.

    Returns:
        Schema string in format "database.schema" if Table node exists.
        Empty string ("") if Table node does not exist.
    """
    query = """
    MATCH (t:Table {name: $table_name})
    WHERE ($project_name IS NULL OR t.project_name = $project_name)
    RETURN t.schema as schema, t.database_name as database_name
    """
    result = session.run(query, table_name=table_name, project_name=project_name)
    record = result.single()
    if not record:
        return ""

    schema = record["schema"] or "public"
    database = record["database_name"] or "default"
    return f"{database}.{schema}"
```

**ë³€ê²½ í›„**:
```python
def get_table_schema(session, table_name: str, project_name: Optional[str]) -> str:
    """Resolve table schema information.

    Returns:
        Schema string (e.g., "public", "dbo") if Table node exists.
        Empty string ("") if Table node does not exist or schema is empty.

    Note:
        - Table ë…¸ë“œê°€ Neo4jì— ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ë¹ˆ ë¬¸ìì—´ ë°˜í™˜
        - Table ë…¸ë“œê°€ ì¡´ì¬í•˜ì§€ë§Œ schema ê°’ì´ ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´ ë°˜í™˜
        - Tableì€ ì—¬ëŸ¬ í”„ë¡œì íŠ¸ì—ì„œ ê³µìœ ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ project_name í•„í„°ë§ ì•ˆ í•¨
    """
    query = """
    MATCH (t:Table {name: $table_name})
    RETURN t.schema as schema
    LIMIT 1
    """
    result = session.run(query, table_name=table_name)
    record = result.single()
    if not record:
        return ""

    schema = record["schema"]
    if not schema or schema.strip() == "":
        return ""

    return schema.strip()
```

**ê°œì„  íš¨ê³¼**:
- Table participantë¥¼ "schema.table" í˜•ì‹ìœ¼ë¡œ ì •í™•íˆ í‘œì‹œ
- Table ë…¸ë“œê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš° ë¹ˆ ë¬¸ìì—´ë¡œ ì²˜ë¦¬
- schema ê°’ì´ ì—†ì„ ê²½ìš° ë¹ˆ ë¬¸ìì—´ë¡œ ì²˜ë¦¬

### 3. ë©”ì„œë“œ í˜¸ì¶œ ìˆœì„œ ë° ë¦¬í„´ ìœ„ì¹˜ ì •í™•ì„± ê°œì„ 

**íŒŒì¼**: `csa/diagrams/sequence/repository.py`

**ìˆ˜ì • ë‚´ìš©**:
- `build_activation_aware_flow` í•¨ìˆ˜ë¥¼ ì „ë©´ ì¬ì‘ì„±í•˜ì—¬ í˜¸ì¶œ ìˆœì„œì™€ ë¦¬í„´ ìœ„ì¹˜ë¥¼ ì •í™•íˆ ì¶”ì 
- activation_stackì„ ì‚¬ìš©í•˜ì—¬ ë©”ì„œë“œ í˜¸ì¶œ ì²´ì¸ì„ ì •í™•íˆ ê´€ë¦¬
- source ë©”ì„œë“œë¥¼ ì°¾ì•„ì„œ ì¤‘ê°„ í˜¸ì¶œë“¤ì„ ìë™ìœ¼ë¡œ return ì²˜ë¦¬

**ë³€ê²½ ì „**:
```python
def build_activation_aware_flow(
    calls: Sequence[Dict],
    main_class_name: str,
    top_method: str,
) -> List[Dict]:
    """Transform raw call list into activation-aware flow."""
    activation_stack: List[Tuple[str, str]] = [(main_class_name, top_method)]
    activation_flow: List[Dict] = []

    for call in calls:
        target_class = call.get("target_class")
        target_method = call.get("target_method")
        if not target_class or not target_method:
            continue

        while activation_stack and not is_call_from_method(call, activation_stack[-1][1]):
            ended = activation_stack.pop()
            activation_flow.append(
                {
                    "type": "deactivate",
                    "class": ended[0],
                    "method": ended[1],
                }
            )

        activation_flow.append({"type": "call", "call": call})
        activation_stack.append((target_class, target_method))

    while activation_stack:
        ended = activation_stack.pop()
        activation_flow.append(
            {
                "type": "deactivate",
                "class": ended[0],
                "method": ended[1],
            }
        )

    return activation_flow
```

**ë³€ê²½ í›„**:
```python
def build_activation_aware_flow(
    calls: Sequence[Dict],
    main_class_name: str,
    top_method: str,
) -> List[Dict]:
    """Transform raw call list into activation-aware flow with proper return handling.

    ì´ í•¨ìˆ˜ëŠ” í˜¸ì¶œ ì²´ì¸ì„ activation-aware flowë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
    ê° ë©”ì„œë“œ í˜¸ì¶œê³¼ ë¦¬í„´ì„ ì¶”ì í•˜ì—¬ ì˜¬ë°”ë¥¸ ìˆœì„œë¡œ activation/deactivation ì´ë²¤íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

    Args:
        calls: í˜¸ì¶œ ì²´ì¸ ë¦¬ìŠ¤íŠ¸ (call_orderë¡œ ì •ë ¬ë˜ì–´ ìˆì–´ì•¼ í•¨)
        main_class_name: ë©”ì¸ í´ë˜ìŠ¤ ì´ë¦„
        top_method: ì‹œì‘ ë©”ì„œë“œ ì´ë¦„

    Returns:
        activation-aware flow ì´ë²¤íŠ¸ ë¦¬ìŠ¤íŠ¸
        - type: "call" - ë©”ì„œë“œ í˜¸ì¶œ
        - type: "return" - ë©”ì„œë“œ ë¦¬í„´
        - type: "deactivate" - ì°¸ì—¬ì ë¹„í™œì„±í™”
    """
    activation_stack: List[Tuple[str, str, str]] = [(main_class_name, top_method, "method")]
    activation_flow: List[Dict] = []

    for idx, call in enumerate(calls):
        source_class = call.get("source_class", "")
        source_method = call.get("source_method", "")
        target_class = call.get("target_class")
        target_method = call.get("target_method")
        call_type = call.get("call_type", "method")

        if not target_class or not target_method:
            continue

        # í˜„ì¬ í˜¸ì¶œì˜ sourceê°€ activation stackì— ìˆëŠ”ì§€ í™•ì¸
        # stackì˜ ë§ˆì§€ë§‰ë¶€í„° ì—­ìˆœìœ¼ë¡œ íƒìƒ‰í•˜ì—¬ sourceë¥¼ ì°¾ìŒ
        source_found_at = -1
        for i in range(len(activation_stack) - 1, -1, -1):
            stack_class, stack_method, stack_type = activation_stack[i]
            if stack_class == source_class and stack_method == source_method:
                source_found_at = i
                break

        # sourceë¥¼ ì°¾ì§€ ëª»í•œ ê²½ìš°, main_classì—ì„œ í˜¸ì¶œí•œ ê²ƒìœ¼ë¡œ ê°„ì£¼
        if source_found_at == -1:
            # stackì„ main_classê¹Œì§€ë§Œ ë‚¨ê¸°ê³  ëª¨ë‘ pop
            while len(activation_stack) > 1:
                ended = activation_stack.pop()
                activation_flow.append({
                    "type": "return",
                    "source": ended[0],
                    "target": activation_stack[-1][0] if activation_stack else main_class_name,
                    "return_type": call.get("return_type", "void"),
                })
        else:
            # source ì´í›„ì˜ ëª¨ë“  stackì„ pop (return ì²˜ë¦¬)
            while len(activation_stack) > source_found_at + 1:
                ended = activation_stack.pop()
                activation_flow.append({
                    "type": "return",
                    "source": ended[0],
                    "target": activation_stack[-1][0] if activation_stack else main_class_name,
                    "return_type": call.get("return_type", "void"),
                })

        # ìƒˆë¡œìš´ í˜¸ì¶œ ì¶”ê°€
        activation_flow.append({"type": "call", "call": call})
        activation_stack.append((target_class, target_method, call_type))

    # ë‚¨ì€ ëª¨ë“  activationì„ ì¢…ë£Œ (return ì²˜ë¦¬)
    while len(activation_stack) > 1:
        ended = activation_stack.pop()
        activation_flow.append({
            "type": "return",
            "source": ended[0],
            "target": activation_stack[-1][0] if activation_stack else main_class_name,
            "return_type": "void",
        })

    return activation_flow
```

**ê°œì„  íš¨ê³¼**:
- ë©”ì„œë“œ í˜¸ì¶œ ìˆœì„œê°€ ì†ŒìŠ¤ì½”ë“œì™€ ì •í™•íˆ ì¼ì¹˜
- ë¦¬í„´ ìœ„ì¹˜(box ê¸¸ì´)ê°€ ì •í™•íˆ ì¼ì¹˜
- ì¤‘ê°„ ë©”ì„œë“œë“¤ì´ ìë™ìœ¼ë¡œ return ì²˜ë¦¬ë˜ì–´ ë‹¤ì´ì–´ê·¸ë¨ì´ ê¹”ë”í•´ì§

### 4. Mermaid ë‹¤ì´ì–´ê·¸ë¨ ìƒì„± ë¡œì§ ê°œì„ 

**íŒŒì¼**: `csa/diagrams/sequence/mermaid.py`

**ìˆ˜ì • ë‚´ìš©**:
- return ì´ë²¤íŠ¸ ì²˜ë¦¬ ë¡œì§ ë‹¨ìˆœí™”
- self_return ë° deactivate ì´ë²¤íŠ¸ ì²˜ë¦¬ ì œê±° (repository.pyì—ì„œ returnìœ¼ë¡œ í†µí•©)

**ë³€ê²½ ì „**:
```python
elif event['type'] == 'return':
    source = event['source']
    target = event['target']
    return_type = event.get('return_type', 'void')

    activation_entry = None
    for idx in range(len(activation_stack) - 1, -1, -1):
        if activation_stack[idx]['participant'] == source:
            activation_entry = activation_stack.pop(idx)
            break

    if activation_entry:
        diagram_lines.append(f"    {source}-->>{target}: return ({return_type})")
        diagram_lines.append(f"    deactivate {source}")
        active_participants.discard(source)

elif event['type'] == 'self_return':
    # ... (self_return ì²˜ë¦¬ ì½”ë“œ)

elif event['type'] == 'deactivate':
    # ... (deactivate ì²˜ë¦¬ ì½”ë“œ)
```

**ë³€ê²½ í›„**:
```python
elif event['type'] == 'return':
    source = event['source']
    target = event['target']
    return_type = event.get('return_type', 'void')

    # activation_stackì—ì„œ sourceë¥¼ ì°¾ì•„ì„œ ì œê±°
    activation_entry = None
    for idx in range(len(activation_stack) - 1, -1, -1):
        if activation_stack[idx]['participant'] == source:
            activation_entry = activation_stack.pop(idx)
            break

    # return ëª…ë ¹ê³¼ deactivate ëª…ë ¹ ìƒì„±
    if source in active_participants:
        diagram_lines.append(f"    {source}-->>{target}: return ({return_type})")
        diagram_lines.append(f"    deactivate {source}")
        active_participants.discard(source)
```

**ê°œì„  íš¨ê³¼**:
- ì½”ë“œ ì¤‘ë³µ ì œê±°
- ì´ë²¤íŠ¸ íƒ€ì… ë‹¨ìˆœí™” (returnìœ¼ë¡œ í†µí•©)
- ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ

### 5. PlantUML ë‹¤ì´ì–´ê·¸ë¨ ìƒì„± ë¡œì§ ê°œì„ 

**íŒŒì¼**: `csa/diagrams/sequence/plantuml.py`

**ìˆ˜ì • ë‚´ìš©**:
- Mermaidì™€ ë™ì¼í•˜ê²Œ return ì´ë²¤íŠ¸ ì²˜ë¦¬ ë¡œì§ ë‹¨ìˆœí™”

**ê°œì„  íš¨ê³¼**:
- Mermaidì™€ PlantUMLì˜ ë¡œì§ ì¼ê´€ì„± ìœ ì§€
- ì½”ë“œ ì¤‘ë³µ ì œê±°
- ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ

## Database Table í˜¸ì¶œ ê´€ê³„ í‘œì‹œ

### ê°œëµì  í˜¸ì¶œ ê´€ê³„

Controller class â†’ Service class â†’ Mapper class â†’ Mapper file(xml) â†’ (sql id) â†’ SqlStatement â†’ (SqlStatement.tables) â†’ Table

### Table Participant í‘œì‹œ ê·œì¹™

1. **Table ì´ë¦„**: `SqlStatement.tables`ì— ìˆëŠ” table ì´ë¦„ìœ¼ë¡œ í‘œì‹œ
2. **Schema ì²˜ë¦¬**:
   - Table ë…¸ë“œì˜ `schema` ê°’ìœ¼ë¡œ í‘œì‹œ
   - Table ë…¸ë“œê°€ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ schema ê°’ì´ ë¹ˆ ë¬¸ìì—´("")ì¸ ê²½ìš° schemaëŠ” ë¹ˆ ë¬¸ìì—´""ë¡œ í‘œì‹œ
3. **Table Participant í‘œì‹œ í˜•ì‹**: `schema.table`
   - schemaê°€ ìˆëŠ” ê²½ìš°: `public.users`
   - schemaê°€ ì—†ëŠ” ê²½ìš°: `users`

### ì™¸ë¶€ í´ë˜ìŠ¤ ì œì™¸ ê·œì¹™

- **ì™¸ë¶€ í´ë˜ìŠ¤**: `project_name` ì†ì„±ì˜ ê°’ì´ ë¹ˆ ë¬¸ìì—´(""), None, nullì´ë©´ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ ì œì™¸
- **Database Table**: ì—¬ëŸ¬ í”„ë¡œì íŠ¸ì—ì„œ í˜¸ì¶œ(ì‚¬ìš©)í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ í¬í•¨

## ê³µí†µ ì¿¼ë¦¬ ë¶„ë¦¬ í˜„í™©

### ì´ë¯¸ ë¶„ë¦¬ëœ ê³µí†µ ì¿¼ë¦¬

`csa/diagrams/sequence/repository.py` íŒŒì¼ì— ë‹¤ìŒ í•¨ìˆ˜ë“¤ì´ ê³µí†µìœ¼ë¡œ ë¶„ë¦¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

1. **`get_class_info`**: í´ë˜ìŠ¤ ì •ë³´ ì¡°íšŒ
2. **`get_class_methods`**: í´ë˜ìŠ¤ì˜ ë©”ì„œë“œ ëª©ë¡ ì¡°íšŒ
3. **`get_method_return_type`**: ë©”ì„œë“œ ë°˜í™˜ íƒ€ì… ì¡°íšŒ
4. **`fetch_call_chain`**: í˜¸ì¶œ ì²´ì¸ ì¡°íšŒ (ë©”ì„œë“œ/SQL/Table í˜¸ì¶œ)
5. **`build_flows`**: í˜¸ì¶œ ì²´ì¸ì„ top-level ë©”ì„œë“œë³„ë¡œ êµ¬ì„±
6. **`is_call_from_method`**: í˜¸ì¶œì´ íŠ¹ì • ë©”ì„œë“œì—ì„œ ë°œìƒí–ˆëŠ”ì§€ í™•ì¸
7. **`build_activation_aware_flow`**: í˜¸ì¶œ ì²´ì¸ì„ activation-aware flowë¡œ ë³€í™˜
8. **`is_external_library_call`**: ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ í˜¸ì¶œ ì—¬ë¶€ í™•ì¸
9. **`get_table_schema`**: Table schema ì •ë³´ ì¡°íšŒ
10. **`should_filter_call`**: í˜¸ì¶œ í•„í„°ë§ ì—¬ë¶€ í™•ì¸
11. **`resolve_project_name`**: í”„ë¡œì íŠ¸ëª… ê²°ì •

### Mermaidì™€ PlantUML ì‚¬ìš© í˜„í™©

ë‘ í¬ë§· ëª¨ë‘ `repository.py`ì˜ ê³µí†µ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤:

- `mermaid.py`: `from csa.diagrams.sequence.repository import ...`
- `plantuml.py`: `from csa.diagrams.sequence.repository import ...`

## í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

### ì°¸ê³  ì†ŒìŠ¤ì½”ë“œ

**íŒŒì¼**: `D:\workspaces\lang-parser-work\lang-parser-springboot\target_src\car-center-devlab\src\main\java\com\carcare\domain\user\controller\UserController.java`

**ë©”ì„œë“œ**: `getUserList()` (114-132 ë¼ì¸)

**í˜¸ì¶œ ìˆœì„œ**:
1. `getCurrentUser()` (137ë¼ì¸)
2. `userService.getUserList(page, size)` (127ë¼ì¸)
3. `userService.getUserCount()` (128ë¼ì¸)
4. `ResponseUtils.success(...)` (130ë¼ì¸)

### ê¸°ëŒ€ ê²°ê³¼

ìˆ˜ì • í›„ ìƒì„±ë˜ëŠ” ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ì€ ë‹¤ìŒê³¼ ê°™ì€ íŠ¹ì§•ì„ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤:

1. **ì •í™•í•œ í˜¸ì¶œ ìˆœì„œ**: ì†ŒìŠ¤ì½”ë“œì˜ í˜¸ì¶œ ìˆœì„œì™€ ì •í™•íˆ ì¼ì¹˜
2. **ì •í™•í•œ ë¦¬í„´ ìœ„ì¹˜**: ê° ë©”ì„œë“œì˜ activation box ê¸¸ì´ê°€ ì •í™•íˆ ì¼ì¹˜
3. **Database Table í‘œì‹œ**: SQL í˜¸ì¶œ í›„ Table participantê°€ í‘œì‹œë¨
4. **ì™¸ë¶€ í´ë˜ìŠ¤ ì œì™¸**: project_nameì´ ì—†ëŠ” í´ë˜ìŠ¤ëŠ” ì œì™¸ë¨

## í–¥í›„ ê°œì„  ì‚¬í•­

1. **ì„±ëŠ¥ ìµœì í™”**: ëŒ€ê·œëª¨ í”„ë¡œì íŠ¸ì—ì„œ ì¿¼ë¦¬ ì„±ëŠ¥ ê°œì„ 
2. **ìºì‹± ì¶”ê°€**: ë°˜ë³µì ì¸ ì¿¼ë¦¬ ê²°ê³¼ ìºì‹±
3. **ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”**: ì˜ˆì™¸ ìƒí™©ì— ëŒ€í•œ ì²˜ë¦¬ ì¶”ê°€
4. **í…ŒìŠ¤íŠ¸ ì½”ë“œ ì¶”ê°€**: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ë° í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±

## ì°¸ê³  ì‚¬í•­

### ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡

1. `csa/diagrams/sequence/repository.py`
   - `_safe_project` í•¨ìˆ˜ docstring ì¶”ê°€
   - `_should_include_method` í•¨ìˆ˜ docstring ë° ë¡œì§ ëª…í™•í™”
   - `get_table_schema` í•¨ìˆ˜ ì „ë©´ ìˆ˜ì •
   - `build_activation_aware_flow` í•¨ìˆ˜ ì „ë©´ ì¬ì‘ì„±

2. `csa/diagrams/sequence/mermaid.py`
   - return ì´ë²¤íŠ¸ ì²˜ë¦¬ ë¡œì§ ë‹¨ìˆœí™”

3. `csa/diagrams/sequence/plantuml.py`
   - return ì´ë²¤íŠ¸ ì²˜ë¦¬ ë¡œì§ ë‹¨ìˆœí™”

### ì£¼ì˜ì‚¬í•­

- ê¸°ì¡´ì— ìƒì„±ëœ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ì€ ì´ì „ ë¡œì§ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìœ¼ë¯€ë¡œ, ìƒˆë¡œìš´ ë‹¤ì´ì–´ê·¸ë¨ì„ ìƒì„±í•´ì•¼ ìˆ˜ì • ì‚¬í•­ì´ ë°˜ì˜ë©ë‹ˆë‹¤.
- Neo4j ë°ì´í„°ë² ì´ìŠ¤ì— Table ë…¸ë“œì˜ `schema` ì†ì„±ì´ ì˜¬ë°”ë¥´ê²Œ ì €ì¥ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

## ì¶”ê°€ ê°œì„  ì‚¬í•­ (2025-10-19 ì˜¤í›„)

### 6. ë©”ì¸ í´ë˜ìŠ¤ ë¦¬í„´ í‘œì‹œ ì¶”ê°€

**íŒŒì¼**: `csa/diagrams/sequence/mermaid.py`, `csa/diagrams/sequence/plantuml.py`

**ë¬¸ì œì **: ë©”ì¸ í´ë˜ìŠ¤ì˜ ë¦¬í„´ì´ í‘œì‹œë˜ì§€ ì•ŠëŠ” ê²½ìš°ê°€ ìˆì—ˆìŒ

**ìˆ˜ì • ë‚´ìš©**:
- `if main_class_name in active_participants:` ì¡°ê±´ì„ ì œê±°
- ë©”ì¸ í´ë˜ìŠ¤ì˜ ë¦¬í„´ì„ í•­ìƒ í‘œì‹œí•˜ë„ë¡ ìˆ˜ì •

**ë³€ê²½ í›„**:
```python
# ë©”ì¸ í´ë˜ìŠ¤ì˜ ë¦¬í„´ì€ í•­ìƒ í‘œì‹œ
final_return_type = top_method_return_type or 'void'
diagram_lines.append(f"    {main_class_name}-->>Client: return ({final_return_type})")
diagram_lines.append(f"    deactivate {main_class_name}")
active_participants.discard(main_class_name)
```

**ê°œì„  íš¨ê³¼**:
- ë©”ì¸ í´ë˜ìŠ¤ì˜ ë¦¬í„´ì´ í•­ìƒ í‘œì‹œë¨
- ë‹¤ì´ì–´ê·¸ë¨ì˜ ì™„ì „ì„± í–¥ìƒ

### 7. Mapper Participant í‘œì‹œ í˜•ì‹ ë³€ê²½

**íŒŒì¼**: `csa/diagrams/sequence/repository.py`, `csa/diagrams/sequence/mermaid.py`, `csa/diagrams/sequence/plantuml.py`

**ìˆ˜ì • ë‚´ìš©**:
- `sql_call_query`ì™€ `fallback_sql_query`ì— `mapper_namespace` ì¶”ê°€
- `sql_event`ì— `mapper_namespace` í•„ë“œ ì¶”ê°€
- Mapper participant í‘œì‹œ í˜•ì‹ ë³€ê²½: `Mapper name <br/>(namespace)`

**ë³€ê²½ ì „**:
```python
sql_display_label = call.get('sql_display') or call.get('mapper_name') or target_package or 'SQL statement'
```

**ë³€ê²½ í›„ (Mermaid)**:
```python
# Mapper participant í‘œì‹œ: 'Mapper name' <br/>({namespace})
mapper_name = call.get('mapper_name') or 'SQL'
mapper_namespace = call.get('mapper_namespace') or ''
if mapper_namespace:
    sql_display_label = f"{mapper_name}<br/>({mapper_namespace})"
else:
    sql_display_label = mapper_name
```

**ë³€ê²½ í›„ (PlantUML)**:
```python
# Mapper participant í‘œì‹œ: 'Mapper name' ({namespace})
mapper_name = call.get('mapper_name') or 'SQL'
mapper_namespace = call.get('mapper_namespace') or ''
if mapper_namespace:
    sql_display_label = f"{mapper_name}\\n({mapper_namespace})"
else:
    sql_display_label = mapper_name
```

**ê°œì„  íš¨ê³¼**:
- Mapper XMLì˜ namespaceê°€ participantì— í‘œì‹œë¨
- Mapper íŒŒì¼ì˜ ì‹ë³„ì´ ìš©ì´í•´ì§

### 8. SQL í˜¸ì¶œ í‘œì‹œ í˜•ì‹ ë³€ê²½

**íŒŒì¼**: `csa/diagrams/sequence/mermaid.py`, `csa/diagrams/sequence/plantuml.py`

**ìˆ˜ì • ë‚´ìš©**:
- SQL í˜¸ì¶œ í‘œì‹œ í˜•ì‹ ë³€ê²½: `sql_id<<logical_name>>`
- logical_nameì´ ì—†ëŠ” ê²½ìš° sql_idë§Œ í‘œì‹œ

**ë³€ê²½ ì „**:
```python
label = call_details.get('sql_logical_name') or method
call_str = f"    {source}->>{target}: {icon} {label}"
```

**ë³€ê²½ í›„**:
```python
# SQL í˜¸ì¶œ í‘œì‹œ: sql_id<<logical_name>>
sql_id = method
sql_logical_name = call_details.get('sql_logical_name') or ''
if sql_logical_name:
    label = f"{sql_id}<<{sql_logical_name}>>"
else:
    label = sql_id
call_str = f"    {source}->>{target}: {icon} {label}"
```

**ê°œì„  íš¨ê³¼**:
- SQL IDì™€ ë…¼ë¦¬ëª…ì´ í•¨ê»˜ í‘œì‹œë¨
- SQL í˜¸ì¶œì˜ ì˜ë„ë¥¼ ëª…í™•íˆ íŒŒì•… ê°€ëŠ¥

**ì˜ˆì‹œ**:
- ë³€ê²½ ì „: `ğŸ” IDë¡œ ì‚¬ìš©ì ì¡°íšŒ`
- ë³€ê²½ í›„: `ğŸ” findById<<IDë¡œ ì‚¬ìš©ì ì¡°íšŒ>>`

### 9. ë©”ì„œë“œ í˜¸ì¶œ ì‹œ Logical Name í‘œì‹œ ì¶”ê°€

**íŒŒì¼**: `csa/diagrams/sequence/repository.py`, `csa/diagrams/sequence/mermaid.py`, `csa/diagrams/sequence/plantuml.py`

**ìˆ˜ì • ë‚´ìš©**:
- `method_call_query`ì— `target.logical_name` ì¶”ê°€
- `call_event`ì— `target_method_logical_name` í•„ë“œ ì¶”ê°€
- ë©”ì„œë“œ í˜¸ì¶œ í‘œì‹œ í˜•ì‹ ë³€ê²½: `method_name()<<logical_name>>`

**ë³€ê²½ ì „**:
```python
call_str = f"    {source}->>{target}: {method}()"
```

**ë³€ê²½ í›„**:
```python
# ë©”ì„œë“œ í˜¸ì¶œ í‘œì‹œ: method_name()<<logical_name>>
method_logical_name = call_details.get('target_method_logical_name') or ''
if method_logical_name:
    method_display = f"{method}()<<{method_logical_name}>>"
else:
    method_display = f"{method}()"
call_str = f"    {source}->>{target}: {method_display}"
```

**ê°œì„  íš¨ê³¼**:
- ë©”ì„œë“œëª…ê³¼ ë…¼ë¦¬ëª…ì´ í•¨ê»˜ í‘œì‹œë¨
- ë©”ì„œë“œ í˜¸ì¶œì˜ ì˜ë„ë¥¼ ëª…í™•íˆ íŒŒì•… ê°€ëŠ¥

**ì˜ˆì‹œ**:
- ë³€ê²½ ì „: `getMyProfile()`
- ë³€ê²½ í›„: `getMyProfile()<<í˜„ì¬ ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ>>`
- logical_nameì´ ì—†ëŠ” ê²½ìš°: `getCurrentUser()` (ë³€ê²½ ì—†ìŒ)

## ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡ (ì „ì²´)

### 1ì°¨ ìˆ˜ì •
1. `csa/diagrams/sequence/repository.py`
   - `_safe_project` í•¨ìˆ˜ docstring ì¶”ê°€
   - `_should_include_method` í•¨ìˆ˜ docstring ë° ë¡œì§ ëª…í™•í™”
   - `get_table_schema` í•¨ìˆ˜ ì „ë©´ ìˆ˜ì •
   - `build_activation_aware_flow` í•¨ìˆ˜ ì „ë©´ ì¬ì‘ì„±

2. `csa/diagrams/sequence/mermaid.py`
   - return ì´ë²¤íŠ¸ ì²˜ë¦¬ ë¡œì§ ë‹¨ìˆœí™”

3. `csa/diagrams/sequence/plantuml.py`
   - return ì´ë²¤íŠ¸ ì²˜ë¦¬ ë¡œì§ ë‹¨ìˆœí™”

### 2ì°¨ ìˆ˜ì • (ì¶”ê°€ ê°œì„ )
1. `csa/diagrams/sequence/repository.py`
   - `method_call_query`ì— `target.logical_name` ì¶”ê°€
   - `sql_call_query`ì™€ `fallback_sql_query`ì— `mapper_namespace` ì¶”ê°€
   - `call_event`ì— `target_method_logical_name` ì¶”ê°€
   - `sql_event`ì— `mapper_namespace` ì¶”ê°€

2. `csa/diagrams/sequence/mermaid.py`
   - ë©”ì¸ í´ë˜ìŠ¤ ë¦¬í„´ í‘œì‹œ ìˆ˜ì • (í•­ìƒ í‘œì‹œ)
   - Mapper participant í‘œì‹œ í˜•ì‹ ë³€ê²½ (`<br/>(namespace)`)
   - SQL í˜¸ì¶œ í‘œì‹œ í˜•ì‹ ë³€ê²½ (`sql_id<<logical_name>>`)
   - ë©”ì„œë“œ í˜¸ì¶œ í‘œì‹œ í˜•ì‹ ë³€ê²½ (`method()<<logical_name>>`)

3. `csa/diagrams/sequence/plantuml.py`
   - ë©”ì¸ í´ë˜ìŠ¤ ë¦¬í„´ í‘œì‹œ ìˆ˜ì • (í•­ìƒ í‘œì‹œ)
   - Mapper participant í‘œì‹œ í˜•ì‹ ë³€ê²½ (`\n(namespace)`)
   - SQL í˜¸ì¶œ í‘œì‹œ í˜•ì‹ ë³€ê²½ (`sql_id<<logical_name>>`)
   - ë©”ì„œë“œ í˜¸ì¶œ í‘œì‹œ í˜•ì‹ ë³€ê²½ (`method()<<logical_name>>`)

## ê²°ë¡ 

ì´ë²ˆ ìˆ˜ì •ìœ¼ë¡œ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ ìƒì„± ë¡œì§ì´ ë‹¤ìŒê³¼ ê°™ì´ ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤:

### 1ì°¨ ê°œì„  ì‚¬í•­
1. **ì •í™•ì„± í–¥ìƒ**: ë©”ì„œë“œ í˜¸ì¶œ ìˆœì„œì™€ ë¦¬í„´ ìœ„ì¹˜ê°€ ì†ŒìŠ¤ì½”ë“œì™€ ì •í™•íˆ ì¼ì¹˜
2. **ê°€ë…ì„± í–¥ìƒ**: ì™¸ë¶€ í´ë˜ìŠ¤ë¥¼ ì œì™¸í•˜ì—¬ ë‹¤ì´ì–´ê·¸ë¨ì´ ê°„ê²°í•´ì§
3. **ì™„ì „ì„± í–¥ìƒ**: Database Tableì´ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ì— í‘œì‹œë¨
4. **ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ**: ê³µí†µ ì¿¼ë¦¬ê°€ repository.pyì— ë¶„ë¦¬ë˜ì–´ ìˆì–´ ìˆ˜ì •ì´ ìš©ì´í•¨

### 2ì°¨ ê°œì„  ì‚¬í•­ (ì¶”ê°€)
1. **ì™„ì „ì„± í–¥ìƒ**: ë©”ì¸ í´ë˜ìŠ¤ì˜ ë¦¬í„´ì´ í•­ìƒ í‘œì‹œë¨
2. **ê°€ë…ì„± í–¥ìƒ**: Mapper participantì— namespaceê°€ í‘œì‹œë¨
3. **ëª…í™•ì„± í–¥ìƒ**: SQL í˜¸ì¶œ ì‹œ IDì™€ ë…¼ë¦¬ëª…ì´ í•¨ê»˜ í‘œì‹œë¨ (`findById<<IDë¡œ ì‚¬ìš©ì ì¡°íšŒ>>`)
4. **ëª…í™•ì„± í–¥ìƒ**: ë©”ì„œë“œ í˜¸ì¶œ ì‹œ ë©”ì„œë“œëª…ê³¼ ë…¼ë¦¬ëª…ì´ í•¨ê»˜ í‘œì‹œë¨ (`getMyProfile()<<í˜„ì¬ ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ>>`)

## ì¶”ê°€ ê°œì„  ì‚¬í•­ (3ì°¨ - 2ë²ˆ, 4ë²ˆ í•­ëª© ì¬ìˆ˜ì •)

### 10. Mapper Participant Namespace í‘œì‹œ ê°œì„ 

**íŒŒì¼**: `csa/diagrams/sequence/repository.py`

**ë¬¸ì œì **:
- SqlStatement ë…¸ë“œì— namespace ì†ì„±ì´ ì—†ê±°ë‚˜ ë¹„ì–´ ìˆì–´ì„œ Mapper participantì— namespaceê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ

**ìˆ˜ì • ë‚´ìš©**:
- MyBatisMapper ë…¸ë“œì™€ ì¡°ì¸í•˜ì—¬ namespaceë¥¼ ì¡°íšŒí•˜ë„ë¡ ìˆ˜ì •
- `OPTIONAL MATCH (mapper:MyBatisMapper)-[:HAS_SQL]->(sql)` ì¶”ê°€
- `COALESCE(sql.namespace, mapper.namespace)` ì‚¬ìš©í•˜ì—¬ namespace ìš°ì„ ìˆœìœ„ ì„¤ì •

**ë³€ê²½ ì „**:
```python
sql_call_query = """
MATCH (source:Method {name: $method_name, class_name: $class_name})-[rel:CALLS]->(sql:SqlStatement)
RETURN
    ...
    sql.mapper_name AS mapper_name,
    sql.namespace AS mapper_namespace,
    ...
"""
```

**ë³€ê²½ í›„**:
```python
sql_call_query = """
MATCH (source:Method {name: $method_name, class_name: $class_name})-[rel:CALLS]->(sql:SqlStatement)
OPTIONAL MATCH (mapper:MyBatisMapper)-[:HAS_SQL]->(sql)
RETURN
    ...
    COALESCE(sql.mapper_name, mapper.name) AS mapper_name,
    COALESCE(sql.namespace, mapper.namespace) AS mapper_namespace,
    ...
"""
```

**ê°œì„  íš¨ê³¼**:
- MyBatisMapper ë…¸ë“œì—ì„œ namespaceë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ
- Mapper participantì— namespaceê°€ ì œëŒ€ë¡œ í‘œì‹œë¨: `UserMapper<br/>(com.carcare.domain.user.mapper.UserMapper)`

### 11. Table í˜¸ì¶œ ê´€ê³„ í‘œì‹œ ê°œì„ 

**íŒŒì¼**: `csa/diagrams/sequence/repository.py`

**ë¬¸ì œì **:
- SqlStatement.tablesê°€ ë¬¸ìì—´ í˜•íƒœë¡œ ì €ì¥ë˜ì–´ ìˆëŠ” ê²½ìš° íŒŒì‹±í•˜ì§€ ëª»í•¨
- Table ì´ë²¤íŠ¸ê°€ ìƒì„±ë˜ì§€ ì•Šì•„ Table participantì™€ Table í˜¸ì¶œì´ ë‹¤ì´ì–´ê·¸ë¨ì— í‘œì‹œë˜ì§€ ì•ŠìŒ

**ìˆ˜ì • ë‚´ìš©**:
1. `_sql_tables_or_empty` í•¨ìˆ˜ ê°œì„ 
   - ë¬¸ìì—´ í˜•íƒœì˜ tables íŒŒì‹± ì§€ì› (ì˜ˆ: `"users,roles"`)
   - ë¦¬ìŠ¤íŠ¸ ë‚´ë¶€ì˜ ë¬¸ìì—´ë„ dictë¡œ ë³€í™˜
2. ë””ë²„ê¹… ë¡œê¹… ì¶”ê°€
   - Tableì´ ì—†ëŠ” ê²½ìš° sql_tablesì™€ sql_columns ê°’ì„ ë¡œê¹…

**ë³€ê²½ ì „**:
```python
def _sql_tables_or_empty(raw_tables):
    if not raw_tables:
        return []
    if isinstance(raw_tables, list):
        return raw_tables
    return []
```

**ë³€ê²½ í›„**:
```python
def _sql_tables_or_empty(raw_tables):
    """SqlStatement.tables ì†ì„±ì„ íŒŒì‹±í•˜ì—¬ í…Œì´ë¸” ëª©ë¡ì„ ë°˜í™˜í•©ë‹ˆë‹¤."""
    if not raw_tables:
        return []

    # ì´ë¯¸ ë¦¬ìŠ¤íŠ¸ì¸ ê²½ìš°
    if isinstance(raw_tables, list):
        result = []
        for item in raw_tables:
            if isinstance(item, dict):
                result.append(item)
            elif isinstance(item, str):
                result.append({"name": item, "schema": ""})
        return result

    # ë¬¸ìì—´ì¸ ê²½ìš° (ì˜ˆ: "users,roles" ë˜ëŠ” "users")
    if isinstance(raw_tables, str):
        table_names = [t.strip() for t in raw_tables.split(",") if t.strip()]
        return [{"name": name, "schema": ""} for name in table_names]

    return []
```

**ë””ë²„ê¹… ë¡œê¹… ì¶”ê°€**:
```python
if not tables:
    LOGGER.debug("No tables found for SQL %s (sql_tables=%s, sql_columns=%s)",
                sql_id, record["sql_tables"], record["sql_columns"])
else:
    LOGGER.debug("Tables referenced by SQL %s: %s", sql_id, tables)
```

**ê°œì„  íš¨ê³¼**:
- SqlStatement.tablesê°€ ë¬¸ìì—´ì¸ ê²½ìš°ì—ë„ íŒŒì‹± ê°€ëŠ¥
- Table ì´ë²¤íŠ¸ê°€ ì œëŒ€ë¡œ ìƒì„±ë¨
- Table participantì™€ Table í˜¸ì¶œì´ ë‹¤ì´ì–´ê·¸ë¨ì— í‘œì‹œë¨
- ë””ë²„ê¹… ë¡œê¹…ìœ¼ë¡œ ë¬¸ì œ ì›ì¸ íŒŒì•… ìš©ì´

**ì˜ˆì‹œ**:
- Mapper -> Table í˜¸ì¶œ: `UserMapper ->> users: ğŸ“¦ public.users`
- Table participant: `participant users as public.users`

## ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡ (ì „ì²´)

### 1ì°¨ ìˆ˜ì •
1. `csa/diagrams/sequence/repository.py`
   - `_safe_project` í•¨ìˆ˜ docstring ì¶”ê°€
   - `_should_include_method` í•¨ìˆ˜ docstring ë° ë¡œì§ ëª…í™•í™”
   - `get_table_schema` í•¨ìˆ˜ ì „ë©´ ìˆ˜ì •
   - `build_activation_aware_flow` í•¨ìˆ˜ ì „ë©´ ì¬ì‘ì„±

2. `csa/diagrams/sequence/mermaid.py`
   - return ì´ë²¤íŠ¸ ì²˜ë¦¬ ë¡œì§ ë‹¨ìˆœí™”

3. `csa/diagrams/sequence/plantuml.py`
   - return ì´ë²¤íŠ¸ ì²˜ë¦¬ ë¡œì§ ë‹¨ìˆœí™”

### 2ì°¨ ìˆ˜ì • (ì¶”ê°€ ê°œì„ )
1. `csa/diagrams/sequence/repository.py`
   - `method_call_query`ì— `target.logical_name` ì¶”ê°€
   - `sql_call_query`ì™€ `fallback_sql_query`ì— `mapper_namespace` ì¶”ê°€
   - `call_event`ì— `target_method_logical_name` ì¶”ê°€
   - `sql_event`ì— `mapper_namespace` ì¶”ê°€

2. `csa/diagrams/sequence/mermaid.py`
   - ë©”ì¸ í´ë˜ìŠ¤ ë¦¬í„´ í‘œì‹œ ìˆ˜ì • (í•­ìƒ í‘œì‹œ)
   - Mapper participant í‘œì‹œ í˜•ì‹ ë³€ê²½ (`<br/>(namespace)`)
   - SQL í˜¸ì¶œ í‘œì‹œ í˜•ì‹ ë³€ê²½ (`sql_id<<logical_name>>`)
   - ë©”ì„œë“œ í˜¸ì¶œ í‘œì‹œ í˜•ì‹ ë³€ê²½ (`method()<<logical_name>>`)

3. `csa/diagrams/sequence/plantuml.py`
   - ë©”ì¸ í´ë˜ìŠ¤ ë¦¬í„´ í‘œì‹œ ìˆ˜ì • (í•­ìƒ í‘œì‹œ)
   - Mapper participant í‘œì‹œ í˜•ì‹ ë³€ê²½ (`\n(namespace)`)
   - SQL í˜¸ì¶œ í‘œì‹œ í˜•ì‹ ë³€ê²½ (`sql_id<<logical_name>>`)
   - ë©”ì„œë“œ í˜¸ì¶œ í‘œì‹œ í˜•ì‹ ë³€ê²½ (`method()<<logical_name>>`)

### 3ì°¨ ìˆ˜ì • (2ë²ˆ, 4ë²ˆ í•­ëª© ì¬ìˆ˜ì •)
1. `csa/diagrams/sequence/repository.py`
   - `sql_call_query`ì™€ `fallback_sql_query`ì— MyBatisMapper ì¡°ì¸ ì¶”ê°€
   - `COALESCE(sql.namespace, mapper.namespace)` ì‚¬ìš©
   - `_sql_tables_or_empty` í•¨ìˆ˜ ì „ë©´ ì¬ì‘ì„± (ë¬¸ìì—´ íŒŒì‹± ì§€ì›)
   - ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë¬¸ìì—´ ì²˜ë¦¬ ì¶”ê°€: `"[]"`, `"null"`, `"None"` â†’ ë¹ˆ ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜
   - Table ë””ë²„ê¹… ë¡œê¹… ì¶”ê°€ (sql_tables íƒ€ì…, table_data íƒ€ì…)
   - mapper_name, mapper_namespace ë””ë²„ê¹… ë¡œê¹… ì¶”ê°€

## ê²°ë¡ 

ì´ë²ˆ ìˆ˜ì •ìœ¼ë¡œ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ ìƒì„± ë¡œì§ì´ ë‹¤ìŒê³¼ ê°™ì´ ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤:

### 1ì°¨ ê°œì„  ì‚¬í•­
1. **ì •í™•ì„± í–¥ìƒ**: ë©”ì„œë“œ í˜¸ì¶œ ìˆœì„œì™€ ë¦¬í„´ ìœ„ì¹˜ê°€ ì†ŒìŠ¤ì½”ë“œì™€ ì •í™•íˆ ì¼ì¹˜
2. **ê°€ë…ì„± í–¥ìƒ**: ì™¸ë¶€ í´ë˜ìŠ¤ë¥¼ ì œì™¸í•˜ì—¬ ë‹¤ì´ì–´ê·¸ë¨ì´ ê°„ê²°í•´ì§
3. **ì™„ì „ì„± í–¥ìƒ**: Database Tableì´ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ì— í‘œì‹œë¨
4. **ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ**: ê³µí†µ ì¿¼ë¦¬ê°€ repository.pyì— ë¶„ë¦¬ë˜ì–´ ìˆì–´ ìˆ˜ì •ì´ ìš©ì´í•¨

### 2ì°¨ ê°œì„  ì‚¬í•­
1. **ì™„ì „ì„± í–¥ìƒ**: ë©”ì¸ í´ë˜ìŠ¤ì˜ ë¦¬í„´ì´ í•­ìƒ í‘œì‹œë¨
2. **ê°€ë…ì„± í–¥ìƒ**: Mapper participantì— namespaceê°€ í‘œì‹œë¨
3. **ëª…í™•ì„± í–¥ìƒ**: SQL í˜¸ì¶œ ì‹œ IDì™€ ë…¼ë¦¬ëª…ì´ í•¨ê»˜ í‘œì‹œë¨ (`findById<<IDë¡œ ì‚¬ìš©ì ì¡°íšŒ>>`)
4. **ëª…í™•ì„± í–¥ìƒ**: ë©”ì„œë“œ í˜¸ì¶œ ì‹œ ë©”ì„œë“œëª…ê³¼ ë…¼ë¦¬ëª…ì´ í•¨ê»˜ í‘œì‹œë¨ (`getMyProfile()<<í˜„ì¬ ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ>>`)

### 3ì°¨ ê°œì„  ì‚¬í•­ (2ë²ˆ, 4ë²ˆ í•­ëª© ì¬ìˆ˜ì • + ì‹¤ì œ ë¬¸ì œ í•´ê²°)
1. **ê°€ë…ì„± í–¥ìƒ**: Mapper participantì— namespaceê°€ í™•ì‹¤íˆ í‘œì‹œë¨ (MyBatisMapper ë…¸ë“œ ì¡°ì¸)
   - ë‹¨, MyBatisMapper ë…¸ë“œì— namespaceê°€ ì—†ìœ¼ë©´ í‘œì‹œë˜ì§€ ì•ŠìŒ (ë°ì´í„° ì´ìŠˆ)
2. **ì™„ì „ì„± í–¥ìƒ**: Table í˜¸ì¶œ ê´€ê³„ê°€ ì œëŒ€ë¡œ í‘œì‹œë¨ (ë¬¸ìì—´ íŒŒì‹± ì§€ì›)
   - ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë¬¸ìì—´ (`"[]"`, `"null"`, `"None"`) ì²˜ë¦¬ ì¶”ê°€
   - `participant []` ì˜¤ë¥˜ í•´ê²°
3. **ë””ë²„ê¹… í–¥ìƒ**: ìƒì„¸í•œ ë””ë²„ê¹… ë¡œê¹…ìœ¼ë¡œ ë¬¸ì œ ì›ì¸ íŒŒì•… ìš©ì´
   - mapper_name, mapper_namespace ë¡œê¹…
   - sql_tables íƒ€ì… ë° ê°’ ë¡œê¹…
   - table_data ì²˜ë¦¬ ê³¼ì • ë¡œê¹…

## ë””ë²„ê¹… ê°€ì´ë“œ

### ë¬¸ì œ ì§„ë‹¨ ë°©ë²•

ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ì´ ì œëŒ€ë¡œ ìƒì„±ë˜ì§€ ì•ŠëŠ” ê²½ìš°, DEBUG ë¡œê·¸ë¥¼ í™œì„±í™”í•˜ì—¬ ë¬¸ì œë¥¼ ì§„ë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**DEBUG ë¡œê·¸ í™œì„±í™” ë°©ë²•**:
```bash
# .env íŒŒì¼ì—ì„œ LOG_LEVEL=DEBUGë¡œ ì„¤ì •í•˜ê±°ë‚˜
# ëª…ë ¹ì–´ ì‹¤í–‰ ì‹œ í™˜ê²½ ë³€ìˆ˜ë¡œ ì§€ì •
LOG_LEVEL=DEBUG python -m csa.cli.main sequence --class-name UserController --method-name getUserList
```

### ì£¼ìš” ë””ë²„ê¹… ë¡œê·¸

#### 1. Mapper Namespace í™•ì¸
```
DEBUG - SQL findUsersWithPaging - mapper_name=UserMapper, mapper_namespace=com.carcare.domain.user.mapper.UserMapper
```

**í™•ì¸ ì‚¬í•­**:
- `mapper_namespace`ê°€ Noneì´ê±°ë‚˜ ë¹ˆ ë¬¸ìì—´ì¸ ê²½ìš°: MyBatisMapper ë…¸ë“œì— namespace ì†ì„±ì´ ì—†ìŒ
- `mapper_name`ì´ Noneì¸ ê²½ìš°: SqlStatement ë…¸ë“œì™€ MyBatisMapper ë…¸ë“œê°€ ì—°ê²°ë˜ì–´ ìˆì§€ ì•ŠìŒ

**í•´ê²° ë°©ë²•**:
- Neo4jì—ì„œ MyBatisMapper ë…¸ë“œë¥¼ í™•ì¸: `MATCH (m:MyBatisMapper) RETURN m.name, m.namespace`
- SqlStatementì™€ MyBatisMapper ê´€ê³„ í™•ì¸: `MATCH (mapper:MyBatisMapper)-[:HAS_SQL]->(sql:SqlStatement) RETURN mapper.name, sql.id`

#### 2. Table ë°ì´í„° íƒ€ì… í™•ì¸
```
DEBUG - SQL findUsersWithPaging - raw sql_tables type=list, value=[{'name': 'users', 'schema': 'public'}]
DEBUG - Tables referenced by SQL findUsersWithPaging: [{'name': 'users', 'schema': 'public'}] (type of first item: dict)
DEBUG - Processing table_data: type=dict, value={'name': 'users', 'schema': 'public'}
```

**í™•ì¸ ì‚¬í•­**:
- `raw sql_tables type`ì´ ì˜ˆìƒê³¼ ë‹¤ë¥¸ ê²½ìš° (ì˜ˆ: str, NoneType)
- `table_data type`ì´ dictê°€ ì•„ë‹Œ ê²½ìš° (ì˜ˆ: list, str)

**ë¬¸ì œ í•´ê²°**:

**ë¬¸ì œ 1**: sql_tablesê°€ ë¬¸ìì—´ì¸ ê²½ìš°
```
DEBUG - SQL findUsersWithPaging - raw sql_tables type=str, value=users,roles
```
â†’ `_sql_tables_or_empty` í•¨ìˆ˜ê°€ ìë™ìœ¼ë¡œ íŒŒì‹±í•©ë‹ˆë‹¤.

**ë¬¸ì œ 2**: table_dataê°€ ë¦¬ìŠ¤íŠ¸ì¸ ê²½ìš°
```
DEBUG - Processing table_data: type=list, value=[{'name': 'users', 'schema': 'public'}]
```
â†’ SqlStatement.tablesì— ì¤‘ì²© ë¦¬ìŠ¤íŠ¸ê°€ ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤. Neo4j ë°ì´í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”.

**ë¬¸ì œ 3**: table_nameì´ ì¶”ì¶œë˜ì§€ ì•ŠëŠ” ê²½ìš°
```
WARNING - No table_name extracted from table_data: {'table': 'users', 'schema': 'public'}
```
â†’ table_dataì— 'name' í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤. Neo4j ë°ì´í„° êµ¬ì¡°ë¥¼ í™•ì¸í•˜ì„¸ìš”.

#### 3. Table ì—†ìŒ ê²½ê³ 
```
DEBUG - No tables found for SQL findUsersWithPaging (sql_tables=None, sql_columns=None)
```

**í™•ì¸ ì‚¬í•­**:
- SqlStatement ë…¸ë“œì— tables ë˜ëŠ” columns ì†ì„±ì´ ì—†ìŒ
- SQL íŒŒì‹± ì‹œ í…Œì´ë¸”ì´ ì¶”ì¶œë˜ì§€ ì•Šì•˜ìŒ

**í•´ê²° ë°©ë²•**:
- Neo4jì—ì„œ SqlStatement ë…¸ë“œ í™•ì¸: `MATCH (sql:SqlStatement {id: 'findUsersWithPaging'}) RETURN sql.tables, sql.columns`
- SQL ì¬ë¶„ì„ ì‹¤í–‰: `python -m csa.cli.main analyze --java-object --clean`

### ì¼ë°˜ì ì¸ ë¬¸ì œì™€ í•´ê²° ë°©ë²•

#### Mapper participantì— namespaceê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ

**ë¡œê·¸ ì˜ˆì‹œ**:
```
DEBUG - SQL findUsersWithPaging - mapper_name=UserMapper, mapper_namespace=None
```

**ì›ì¸**:
1. MyBatisMapper ë…¸ë“œì— namespace ì†ì„±ì´ ì—†ìŒ (ê°€ì¥ í”í•œ ì›ì¸)
2. SqlStatementì™€ MyBatisMapperê°€ ì—°ê²°ë˜ì–´ ìˆì§€ ì•ŠìŒ

**ì§„ë‹¨ ë°©ë²•**:

Neo4j ë¸Œë¼ìš°ì €ì—ì„œ ë‹¤ìŒ ì¿¼ë¦¬ë¡œ í™•ì¸:

```cypher
// 1. MyBatisMapper ë…¸ë“œì˜ namespace í™•ì¸
MATCH (m:MyBatisMapper {name: 'UserMapper'})
RETURN m.name, m.namespace

// 2. SqlStatementì™€ MyBatisMapper ì—°ê²° í™•ì¸
MATCH (mapper:MyBatisMapper)-[:HAS_SQL]->(sql:SqlStatement {id: 'findUsersWithPaging'})
RETURN mapper.name, mapper.namespace, sql.id

// 3. ëª¨ë“  MyBatisMapperì˜ namespace í™•ì¸
MATCH (m:MyBatisMapper)
RETURN m.name, m.namespace
ORDER BY m.name
```

**í•´ê²° ë°©ë²•**:

**ë°©ë²• 1: Java ì¬ë¶„ì„ (ê¶Œì¥)**
```bash
# ì „ì²´ ì¬ë¶„ì„
python -m csa.cli.main analyze --java-object --clean --project-name myproject
```

**ë°©ë²• 2: Neo4jì—ì„œ ì§ì ‘ namespace ì—…ë°ì´íŠ¸**

MyBatisMapper XML íŒŒì¼ì—ì„œ namespaceë¥¼ í™•ì¸í•˜ê³  ì§ì ‘ ì—…ë°ì´íŠ¸:

```cypher
// UserMapper.xmlì—ì„œ namespace í™•ì¸ í›„ ì—…ë°ì´íŠ¸
// <mapper namespace="com.carcare.domain.user.mapper.UserMapper">
MATCH (m:MyBatisMapper {name: 'UserMapper'})
SET m.namespace = 'com.carcare.domain.user.mapper.UserMapper'
RETURN m.name, m.namespace
```

**ë°©ë²• 3: ëª¨ë“  MyBatisMapperì— namespace ì¼ê´„ ì—…ë°ì´íŠ¸**

í”„ë¡œì íŠ¸ì˜ íŒ¨í‚¤ì§€ êµ¬ì¡°ë¥¼ ì•Œê³  ìˆëŠ” ê²½ìš°:

```cypher
// ì˜ˆ: com.carcare.domain.{domain}.mapper.{MapperName}
MATCH (m:MyBatisMapper)
WHERE m.namespace IS NULL OR m.namespace = ''
// ì‹¤ì œ í”„ë¡œì íŠ¸ì— ë§ê²Œ ìˆ˜ì • í•„ìš”
SET m.namespace = 'com.carcare.domain.user.mapper.' + m.name
RETURN m.name, m.namespace
```

#### Table participantê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ

**ë¡œê·¸ ì˜ˆì‹œ**:
```
DEBUG - SQL findUsersWithPaging - raw sql_tables type=str, value=[]
DEBUG - Tables referenced by SQL findUsersWithPaging: [{'name': '[]', 'schema': ''}]
DEBUG - Processing table_data: type=dict, value={'name': '[]', 'schema': ''}
```

**ì›ì¸**:
1. SqlStatement.tablesì— ë¹ˆ ë¦¬ìŠ¤íŠ¸ì˜ ë¬¸ìì—´ í‘œí˜„ (`"[]"`)ì´ ì €ì¥ë¨ (ê°€ì¥ í”í•œ ì›ì¸)
2. SqlStatement.tablesê°€ None ë˜ëŠ” ì‹¤ì œ ë¹ˆ ë°°ì—´
3. SqlStatement.columnsë„ None ë˜ëŠ” ë¹ˆ ë°°ì—´
4. SQL íŒŒì‹± ì‹œ í…Œì´ë¸”ì´ ì œëŒ€ë¡œ ì¶”ì¶œë˜ì§€ ì•ŠìŒ

**ì§„ë‹¨ ë°©ë²•**:

Neo4j ë¸Œë¼ìš°ì €ì—ì„œ ë‹¤ìŒ ì¿¼ë¦¬ë¡œ í™•ì¸:

```cypher
// 1. SqlStatementì˜ tablesì™€ columns í™•ì¸
MATCH (sql:SqlStatement {id: 'findUsersWithPaging'})
RETURN sql.id, sql.tables, sql.columns, sql.sql_type

// 2. ëª¨ë“  SqlStatementì˜ tables í™•ì¸
MATCH (sql:SqlStatement)
RETURN sql.id, sql.tables, sql.columns
LIMIT 10
```

**í•´ê²° ë°©ë²•**:

**ë¬¸ì œ 1: sql_tablesê°€ `"[]"` ë¬¸ìì—´ì¸ ê²½ìš°**

ì´ ë¬¸ì œëŠ” ì½”ë“œë¡œ ì´ë¯¸ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤ (`_sql_tables_or_empty` í•¨ìˆ˜). ë‹¤ì‹œ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ì„ ìƒì„±í•˜ë©´ í•´ê²°ë©ë‹ˆë‹¤.

**ë¬¸ì œ 2: sql_tablesê°€ ì‹¤ì œë¡œ ë¹„ì–´ ìˆëŠ” ê²½ìš°**

Java ì¬ë¶„ì„ì´ í•„ìš”í•©ë‹ˆë‹¤:

```bash
# ì „ì²´ ì¬ë¶„ì„ (Java + DB)
python -m csa.cli.main analyze --all-objects --clean --project-name myproject
```

**ë¬¸ì œ 3: SQL íŒŒì‹± ë¡œì§ ë¬¸ì œ**

íŠ¹ì • SQL ë¬¸ë§Œ í…Œì´ë¸”ì´ ì¶”ì¶œë˜ì§€ ì•ŠëŠ” ê²½ìš°, SQL íŒŒì„œë¥¼ ë””ë²„ê¹…í•´ì•¼ í•©ë‹ˆë‹¤:

```cypher
// ë¬¸ì œê°€ ìˆëŠ” SQLë¬¸ í™•ì¸
MATCH (sql:SqlStatement {id: 'findUsersWithPaging'})
RETURN sql.sql_text
```

SQL íŒŒì„œê°€ ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•ŠëŠ” ê²½ìš°, ìˆ˜ë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸:

```cypher
// ìˆ˜ë™ìœ¼ë¡œ tables ì—…ë°ì´íŠ¸
MATCH (sql:SqlStatement {id: 'findUsersWithPaging'})
SET sql.tables = [
  {name: 'users', schema: 'public'},
  {name: 'roles', schema: 'public'}
]
RETURN sql.id, sql.tables
```

#### participant [] as [] ì˜¤ë¥˜ (ìˆ˜ì • ì™„ë£Œ)

**ë¡œê·¸ ì˜ˆì‹œ**:
```
participant [] as []
SQL->>[]: ğŸ“¦ []
```

**ì›ì¸**:
- SqlStatement.tablesì— ë¹ˆ ë¦¬ìŠ¤íŠ¸ì˜ ë¬¸ìì—´ í‘œí˜„ (`"[]"`)ì´ ì €ì¥ë¨
- `_sql_tables_or_empty` í•¨ìˆ˜ê°€ `"[]"` ë¬¸ìì—´ì„ í…Œì´ë¸” ì´ë¦„ìœ¼ë¡œ íŒŒì‹±í•¨
- ê²°ê³¼: `table_name = "[]"`

**í•´ê²° ì™„ë£Œ**:

ì´ ë¬¸ì œëŠ” `_sql_tables_or_empty` í•¨ìˆ˜ë¥¼ ìˆ˜ì •í•˜ì—¬ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤:

```python
# ë¹ˆ ë¦¬ìŠ¤íŠ¸/Noneì˜ ë¬¸ìì—´ í‘œí˜„ ì œê±°
if stripped in ('[]', 'null', 'None', '""', "''"):
    return []
```

**ì¬ì‹¤í–‰**:
```bash
# ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ ì¬ìƒì„±
python -m csa.cli.main sequence --class-name UserController --method-name getUserList
```

ì´ë¥¼ í†µí•´ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ì´ ì‹¤ì œ ì½”ë“œ ë™ì‘ì„ ë”ìš± ì •í™•í•˜ê²Œ ë°˜ì˜í•˜ê³ , ê°œë°œìê°€ ì½”ë“œì˜ ì˜ë„ë¥¼ ì‰½ê²Œ íŒŒì•…í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.
