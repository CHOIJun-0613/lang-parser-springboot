# ë¡œê·¸ íŒŒì¼ ëª…ë ¹ì–´ë³„ ë¶„ë¦¬ ê°œì„ ì•ˆ

**ì‘ì„±ì¼**: 2025-10-18
**ëª©ì **: ëª…ë ¹ì–´ë³„ë¡œ ë…ë¦½ì ì¸ ë¡œê·¸ íŒŒì¼ ìƒì„±

---

## ğŸ“‹ í˜„ì¬ ìƒí™©

### ë¬¸ì œì 

```bash
logs/
â”œâ”€â”€ analyze-20251018.log   # analyze ëª…ë ¹ì–´ ë¡œê·¸
â””â”€â”€ run-20251018.log       # ëª¨ë“  ì„œë¸Œ ëª¨ë“ˆ ë¡œê·¸ (ì¤‘ë³µ)
```

**ì›ì¸**:
1. `lifecycle.py:35`ì—ì„œ `get_logger(__name__, command=command_name)` í˜¸ì¶œ âœ…
2. í•˜ì§€ë§Œ **ì„œë¸Œ ëª¨ë“ˆ**ë“¤ì´ `get_logger(__name__)` í˜¸ì¶œ (command ì—†ìŒ) âŒ
3. `logger.py:98`ì—ì„œ commandê°€ Noneì´ë©´ `_current_command` ë˜ëŠ” `"run"` ì‚¬ìš©
4. `_current_command`ê°€ ì„¤ì •ë˜ì§€ ì•Šì•„ì„œ `"run"` ì‚¬ìš© â†’ `run-20251018.log` ìƒì„±

### ì˜í–¥ë°›ëŠ” ëª¨ë“ˆ (ì¼ë¶€)

```python
# command íŒŒë¼ë¯¸í„° ì—†ì´ get_logger í˜¸ì¶œí•˜ëŠ” ëª¨ë“ˆë“¤
csa/parsers/java/logical_name.py
csa/parsers/java/description.py
csa/parsers/db/ddl_parser.py
csa/parsers/sql/parser.py
csa/diagrams/sequence/mermaid.py
csa/diagrams/sequence/plantuml.py
csa/services/db_call_analysis/base.py
... (ì´ 100ê°œ ì´ìƒ)
```

---

## âœ… í•´ê²° ë°©ì•ˆ

### ë°©ì•ˆ 1: `set_command_context()` í™œìš© (ê¶Œì¥)

**ì¥ì **:
- ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ìµœì†Œí™”
- ì „ì—­ ì»¨í…ìŠ¤íŠ¸ë¡œ ëª¨ë“  ëª¨ë“ˆì— ìë™ ì ìš©
- `logger.py`ì— ì´ë¯¸ êµ¬í˜„ë˜ì–´ ìˆìŒ

**êµ¬í˜„**:

#### 1. lifecycle.py ìˆ˜ì •

```python
# /workspace/csa/cli/core/lifecycle.py

from csa.utils.logger import get_logger, set_command_context  # ì¶”ê°€

def start(command_name: str) -> Dict[str, Any]:
    """CLI ëª…ë ¹ ì‹¤í–‰ ì „ í˜¸ì¶œë˜ëŠ” ê³µí†µ ì´ˆê¸°í™” í•¨ìˆ˜."""

    # âœ… ì „ì—­ ì»¨í…ìŠ¤íŠ¸ ì„¤ì • (ëª¨ë“  ì„œë¸Œ ëª¨ë“ˆì— ì˜í–¥)
    set_command_context(command_name)

    start_time = datetime.now()
    logger = get_logger(__name__, command=command_name)
    logger.info("")
    logger.info(f"====== {command_name} ì‘ì—… ì‹œì‘ ======")

    # ... ë‚˜ë¨¸ì§€ ì½”ë“œ ë™ì¼
```

#### 2. ë™ì‘ í™•ì¸

```python
# analyze ëª…ë ¹ì–´ ì‹¤í–‰ ì‹œ
set_command_context("analyze")  # â† ì „ì—­ ì„¤ì •
â†“
ëª¨ë“  get_logger(__name__) í˜¸ì¶œì´ "analyze" ì»¨í…ìŠ¤íŠ¸ ì‚¬ìš©
â†“
logs/analyze-20251018.log ì—ë§Œ ê¸°ë¡
```

**ê²°ê³¼**:
```bash
logs/
â”œâ”€â”€ analyze-20251018.log      # python -m csa.cli.main analyze ...
â”œâ”€â”€ sequence-20251018.log     # python -m csa.cli.main sequence ...
â”œâ”€â”€ crud-matrix-20251018.log  # python -m csa.cli.main crud-matrix ...
â””â”€â”€ run-20251018.log          # ê¸°íƒ€ ëª…ë ¹ì–´
```

---

### ë°©ì•ˆ 2: ëª¨ë“  ëª¨ë“ˆ ìˆ˜ì • (ë¹„ê¶Œì¥)

**ë‹¨ì **:
- 100ê°œ ì´ìƒ íŒŒì¼ ìˆ˜ì • í•„ìš”
- ìœ ì§€ë³´ìˆ˜ ë¶€ë‹´
- ìƒˆë¡œìš´ ëª¨ë“ˆ ì¶”ê°€ ì‹œ ëˆ„ë½ ìœ„í—˜

**êµ¬í˜„ ì˜ˆì‹œ**:
```python
# ê¸°ì¡´
logger = get_logger(__name__)

# ìˆ˜ì • í›„
logger = get_logger(__name__)  # ê·¸ëŒ€ë¡œ ë‘ê³  ì „ì—­ ì»¨í…ìŠ¤íŠ¸ ì˜ì¡´
```

---

## ğŸ› ï¸ êµ¬í˜„ ê³„íš

### Step 1: lifecycle.py ìˆ˜ì •

**íŒŒì¼**: `/workspace/csa/cli/core/lifecycle.py`

**ë³€ê²½ ë‚´ìš©**:
```python
from csa.utils.logger import get_logger, set_command_context  # ì¶”ê°€

def start(command_name: str) -> Dict[str, Any]:
    # ì „ì—­ ì»¨í…ìŠ¤íŠ¸ ì„¤ì • ì¶”ê°€
    set_command_context(command_name)

    start_time = datetime.now()
    logger = get_logger(__name__, command=command_name)
    # ... ë‚˜ë¨¸ì§€ ë™ì¼
```

### Step 2: í…ŒìŠ¤íŠ¸

```bash
# 1. analyze ëª…ë ¹ì–´
python -m csa.cli.main analyze --all-objects --clean --project-name test
â†’ logs/analyze-20251018.log ìƒì„± í™•ì¸

# 2. sequence ëª…ë ¹ì–´
python -m csa.cli.main sequence --class-name TestClass
â†’ logs/sequence-20251018.log ìƒì„± í™•ì¸

# 3. crud-matrix ëª…ë ¹ì–´
python -m csa.cli.main crud-matrix --project-name test
â†’ logs/crud-matrix-20251018.log ìƒì„± í™•ì¸
```

### Step 3: ê²€ì¦

```bash
# ë¡œê·¸ íŒŒì¼ í™•ì¸
ls -la logs/

# ê¸°ëŒ€ ê²°ê³¼:
# - analyze-20251018.log (analyze ì „ìš©)
# - sequence-20251018.log (sequence ì „ìš©)
# - crud-matrix-20251018.log (crud-matrix ì „ìš©)
# - run-20251018.log ì‚­ì œ ë˜ëŠ” ìµœì†Œí™”
```

---

## ğŸ“Š ëª…ë ¹ì–´ë³„ ë¡œê·¸ íŒŒì¼ ë§¤í•‘

| ëª…ë ¹ì–´ | ë¡œê·¸ íŒŒì¼ëª… | ì˜ˆì‹œ |
|--------|------------|------|
| analyze | `analyze-YYYYMMDD.log` | `analyze-20251018.log` |
| sequence | `sequence-YYYYMMDD.log` | `sequence-20251018.log` |
| crud-matrix | `crud-matrix-YYYYMMDD.log` | `crud-matrix-20251018.log` |
| db-call-chain | `db-call-chain-YYYYMMDD.log` | `db-call-chain-20251018.log` |
| ê¸°íƒ€ | `run-YYYYMMDD.log` | `run-20251018.log` |

---

## ğŸ” ìƒì„¸ ì„¤ëª…

### `set_command_context()` í•¨ìˆ˜ ë™ì‘

**íŒŒì¼**: `/workspace/csa/utils/logger.py`

```python
# ì „ì—­ ë³€ìˆ˜
_current_command = None

def set_command_context(command: str):
    """í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ëª…ë ¹ì–´ ì»¨í…ìŠ¤íŠ¸ ì„¤ì •"""
    global _current_command
    _current_command = command
```

**íë¦„**:
1. `lifecycle.start("analyze")` í˜¸ì¶œ
2. `set_command_context("analyze")` ì‹¤í–‰ â†’ `_current_command = "analyze"`
3. ì„œë¸Œ ëª¨ë“ˆì—ì„œ `get_logger(__name__)` í˜¸ì¶œ
4. `logger.py:98`ì—ì„œ `command = _current_command` ì‚¬ìš©
5. `{command}-YYYYMMDD.log` íŒŒì¼ ìƒì„±

### ê¸°ì¡´ ì½”ë“œì™€ì˜ í˜¸í™˜ì„±

**ë³€ê²½ ì „**:
```python
logger = get_logger(__name__)  # command=None
â†“
_current_commandë„ None
â†“
logger.py:98ì—ì„œ "run" ì‚¬ìš©
â†“
run-20251018.log ìƒì„±
```

**ë³€ê²½ í›„**:
```python
set_command_context("analyze")  # ì „ì—­ ì„¤ì •
logger = get_logger(__name__)   # command=None
â†“
_current_command = "analyze"
â†“
logger.py:98ì—ì„œ "analyze" ì‚¬ìš©
â†“
analyze-20251018.log ìƒì„±
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. ë©€í‹°ìŠ¤ë ˆë”© í™˜ê²½

**í˜„ì¬ êµ¬í˜„**:
- ì „ì—­ ë³€ìˆ˜ `_current_command` ì‚¬ìš©
- ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤, ë‹¨ì¼ ëª…ë ¹ì–´ ì‹¤í–‰ í™˜ê²½ì—ì„œ ì•ˆì „

**ë©€í‹°ìŠ¤ë ˆë”© ì‹œ ë¬¸ì œ**:
- ì—¬ëŸ¬ ëª…ë ¹ì–´ ë™ì‹œ ì‹¤í–‰ ì‹œ `_current_command` ì¶©ëŒ ê°€ëŠ¥
- í˜„ì¬ CSAëŠ” CLI ë„êµ¬ì´ë¯€ë¡œ ë™ì‹œ ì‹¤í–‰ ì—†ìŒ

### 2. í…ŒìŠ¤íŠ¸ í™˜ê²½

**ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**:
```python
# í…ŒìŠ¤íŠ¸ ì „ ì»¨í…ìŠ¤íŠ¸ ì„¤ì •
from csa.utils.logger import set_command_context

def test_analyze():
    set_command_context("test-analyze")
    # ... í…ŒìŠ¤íŠ¸ ë¡œì§
```

### 3. ë¡œê·¸ íŒŒì¼ ì •ë¦¬

**í˜„ì¬ ì„¤ì •**:
- `logger.py:30`: 7ì¼ ì´ì „ ë¡œê·¸ ìë™ ì‚­ì œ
- ëª¨ë“  `*.log` íŒŒì¼ ëŒ€ìƒ

**ìœ ì§€**:
- ëª…ë ¹ì–´ë³„ ë¡œê·¸ íŒŒì¼ë„ ë™ì¼í•˜ê²Œ 7ì¼ í›„ ìë™ ì‚­ì œ

---

## ğŸ“ˆ ì˜ˆìƒ íš¨ê³¼

### Before (í˜„ì¬)

```
logs/
â”œâ”€â”€ analyze-20251018.log   (52KB)  â† analyze ëª…ë ¹ì–´ ë¡œê·¸
â””â”€â”€ run-20251018.log       (49KB)  â† ì„œë¸Œ ëª¨ë“ˆ ë¡œê·¸ (ì¤‘ë³µ)
```

**ë¬¸ì œ**:
- ë™ì¼í•œ ë¡œê·¸ê°€ ë‘ íŒŒì¼ì— ì¤‘ë³µ ê¸°ë¡
- ë¡œê·¸ íŒŒì¼ ìš©ëŸ‰ ë‚­ë¹„
- ë¡œê·¸ ê²€ìƒ‰ ì‹œ í˜¼ë€

### After (ê°œì„  í›„)

```
logs/
â”œâ”€â”€ analyze-20251018.log   (100KB)  â† analyze ì „ìš© (í†µí•©)
â”œâ”€â”€ sequence-20251018.log  (50KB)   â† sequence ì „ìš©
â””â”€â”€ crud-matrix-20251018.log (30KB) â† crud-matrix ì „ìš©
```

**íš¨ê³¼**:
- âœ… ëª…ë ¹ì–´ë³„ ë…ë¦½ì ì¸ ë¡œê·¸ íŒŒì¼
- âœ… ì¤‘ë³µ ê¸°ë¡ ì œê±°
- âœ… ë¡œê·¸ ê²€ìƒ‰ ë° ë¶„ì„ ìš©ì´
- âœ… ë””ë²„ê¹… íš¨ìœ¨ì„± í–¥ìƒ

---

## ğŸ¯ ê²°ë¡ 

### ê¶Œì¥ ë°©ì•ˆ: ë°©ì•ˆ 1 (set_command_context í™œìš©)

**ì´ìœ **:
1. **ìµœì†Œ ìˆ˜ì •**: lifecycle.py 1ì¤„ ì¶”ê°€ë§Œìœ¼ë¡œ í•´ê²°
2. **ìë™ ì ìš©**: ëª¨ë“  ì„œë¸Œ ëª¨ë“ˆ ìë™ ì ìš©
3. **ìœ ì§€ë³´ìˆ˜**: ìƒˆë¡œìš´ ëª¨ë“ˆ ì¶”ê°€ ì‹œì—ë„ ìë™ ì‘ë™
4. **ê¸°ì¡´ êµ¬ì¡° í™œìš©**: ì´ë¯¸ êµ¬í˜„ëœ ê¸°ëŠ¥ ì‚¬ìš©

**êµ¬í˜„ ë‚œì´ë„**: â­ (ë§¤ìš° ì‰¬ì›€)
**ì†Œìš” ì‹œê°„**: 5ë¶„
**í…ŒìŠ¤íŠ¸ ì‹œê°„**: 10ë¶„

---

**ìƒíƒœ**: âœ… **êµ¬í˜„ ì™„ë£Œ** (2025-10-18 18:05)

**ìµœì¢… ê²°ê³¼**:
- âœ… analyze-20251018.log (168ì¤„)
- âœ… sequence-20251018.log (13ì¤„) â† ì‹ ê·œ!
- âœ… crud-matrix-20251018.log (8ì¤„) â† ì‹ ê·œ!
- âœ… run-20251018.log (9ì¤„) - ìµœì†Œí™”
- âœ… ì´ í¬ê¸°: 101KB â†’ 13.3KB (86.8% ê°ì†Œ)

**ìƒì„¸ ë³´ê³ ì„œ**: `/workspace/docs/ë¡œê·¸íŒŒì¼_ë¶„ë¦¬_êµ¬í˜„_ì™„ë£Œ_20251018.md`
