# Pydantic í•„ë“œëª… ì¶©ëŒ ìˆ˜ì • ì‘ì—…

**ì‘ì„±ì¼**: 2025-10-20
**ì‘ì—…ì**: Claude Code
**ìš°ì„ ìˆœìœ„**: ğŸ”´ High
**ì˜ˆìƒ ì‹œê°„**: 30ë¶„

---

## ğŸ“‹ ì‘ì—… ê°œìš”

`TableUsageSpec` ëª¨ë¸ì˜ `schema` í•„ë“œê°€ Pydantic `BaseModel`ì˜ `schema()` ë©”ì„œë“œì™€ ì¶©ëŒí•˜ì—¬ ê²½ê³ ê°€ ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤.

---

## ğŸ› ë¬¸ì œ ìƒí™©

### ê²½ê³  ë©”ì‹œì§€
```
UserWarning: Field name "schema" in "TableUsageSpec" shadows an attribute in parent "BaseModel"
```

### ë¬¸ì œ ì½”ë“œ
```python
# csa/models/class_spec.py:78-83
class TableUsageSpec(BaseModel):
    """í…Œì´ë¸” ì‚¬ìš© ëª…ì„¸ ì •ë³´"""
    table_name: str
    schema: str = "public"  # â† ë¬¸ì œ!
    operations: List[str] = []
    description: str = ""
```

### ì›ì¸
- Pydantic v2ì˜ `BaseModel`ì€ `schema()` ë©”ì„œë“œë¥¼ ê°€ì§€ê³  ìˆìŒ
- í•„ë“œëª… `schema`ê°€ ì´ ë©”ì„œë“œë¥¼ ê°€ë¦¼ (shadowing)
- ëŸ°íƒ€ì„ ì˜¤ë¥˜ëŠ” ì—†ì§€ë§Œ ê²½ê³  ë°œìƒ ë° ì½”ë“œ ëª…í™•ì„± ì €í•´

---

## ğŸ”§ í•´ê²° ë°©ì•ˆ

### í•„ë“œëª… ë³€ê²½
```python
schema: str = "public"  # Before
db_schema: str = "public"  # After
```

### ì˜í–¥ ë²”ìœ„
1. `csa/models/class_spec.py` - ëª¨ë¸ ì •ì˜
2. `csa/services/class_spec/repository.py` - CRUD ì •ë³´ ì¡°íšŒ
3. `csa/services/class_spec/template.py` - í…œí”Œë¦¿ ë Œë”ë§

---

## ğŸ“ ìˆ˜ì • ê³„íš

### Step 1: ëª¨ë¸ ìˆ˜ì •
**íŒŒì¼**: `csa/models/class_spec.py:78-83`

**Before**:
```python
class TableUsageSpec(BaseModel):
    """í…Œì´ë¸” ì‚¬ìš© ëª…ì„¸ ì •ë³´"""
    table_name: str
    schema: str = "public"
    operations: List[str] = []
    description: str = ""
```

**After**:
```python
class TableUsageSpec(BaseModel):
    """í…Œì´ë¸” ì‚¬ìš© ëª…ì„¸ ì •ë³´"""
    table_name: str
    db_schema: str = "public"  # schema â†’ db_schema
    operations: List[str] = []
    description: str = ""
```

---

### Step 2: Repository ìˆ˜ì •
**íŒŒì¼**: `csa/services/class_spec/repository.py:360-380`

**Before**:
```python
key = f"{schema}.{table_name}"
if key not in table_operations:
    table_operations[key] = {
        "table_name": table_name,
        "schema": schema,  # â† ìˆ˜ì • í•„ìš”
        "operations": set()
    }
```

**After**:
```python
key = f"{schema}.{table_name}"
if key not in table_operations:
    table_operations[key] = {
        "table_name": table_name,
        "db_schema": schema,  # schema â†’ db_schema
        "operations": set()
    }
```

**ìˆ˜ì • ìœ„ì¹˜**:
- Line ~373: ë”•ì…”ë„ˆë¦¬ í‚¤ ë³€ê²½

---

### Step 3: Template ìˆ˜ì •
**íŒŒì¼**: `csa/services/class_spec/template.py:265-280`

**Before**:
```python
def _render_database_info(self, table_usage: List[TableUsageSpec]) -> str:
    """ë°ì´í„°ë² ì´ìŠ¤ ì—°ê´€ ì •ë³´ ë Œë”ë§"""
    # ...
    for idx, table in enumerate(table_usage, 1):
        operations_str = "/".join(sorted(table.operations)) if table.operations else "-"
        lines.append(
            f"| {idx} | {table.table_name} | {table.schema} | "  # â† ìˆ˜ì • í•„ìš”
            f"{operations_str} | {table.description or '-'} |"
        )
```

**After**:
```python
def _render_database_info(self, table_usage: List[TableUsageSpec]) -> str:
    """ë°ì´í„°ë² ì´ìŠ¤ ì—°ê´€ ì •ë³´ ë Œë”ë§"""
    # ...
    for idx, table in enumerate(table_usage, 1):
        operations_str = "/".join(sorted(table.operations)) if table.operations else "-"
        lines.append(
            f"| {idx} | {table.table_name} | {table.db_schema} | "  # schema â†’ db_schema
            f"{operations_str} | {table.description or '-'} |"
        )
```

**ìˆ˜ì • ìœ„ì¹˜**:
- Line ~276: í…œí”Œë¦¿ ë Œë”ë§ ì‹œ í•„ë“œëª… ë³€ê²½

---

## âœ… í…ŒìŠ¤íŠ¸ ê³„íš

### 1. ê²½ê³  ë©”ì‹œì§€ í™•ì¸
```bash
python -m csa.cli.main class-spec \
  --project-name car-center-devlab \
  --class-name NotificationRepository
```

**ê¸°ëŒ€ ê²°ê³¼**:
- âŒ Before: `UserWarning: Field name "schema" in "TableUsageSpec" shadows an attribute in parent "BaseModel"`
- âœ… After: ê²½ê³  ë©”ì‹œì§€ ì—†ìŒ

### 2. ìƒì„±ëœ ëª…ì„¸ì„œ í™•ì¸
```bash
# ìƒì„±ëœ íŒŒì¼ í™•ì¸
cat output/class-spec/.../CLASS_SPEC_NotificationRepository_*.md | grep "ìŠ¤í‚¤ë§ˆ"
```

**ê¸°ëŒ€ ê²°ê³¼**:
```markdown
| No | í…Œì´ë¸”ëª… | ìŠ¤í‚¤ë§ˆ | CRUD ì‘ì—… | ì„¤ëª… |
|----|----------|--------|-----------|------|
| 1 | notifications | public | C/D/R/U | - |
```

### 3. Python ê²€ì¦
```python
from csa.models.class_spec import TableUsageSpec

# ëª¨ë¸ ìƒì„± í…ŒìŠ¤íŠ¸
table = TableUsageSpec(
    table_name="users",
    db_schema="public",
    operations=["C", "R", "U", "D"]
)

assert table.db_schema == "public"
assert table.table_name == "users"
print("âœ“ ëª¨ë¸ ìƒì„± ì„±ê³µ")
```

---

## ğŸ“Š ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Step 1: `models/class_spec.py` ìˆ˜ì •
- [ ] Step 2: `repository.py` ìˆ˜ì •
- [ ] Step 3: `template.py` ìˆ˜ì •
- [ ] í…ŒìŠ¤íŠ¸ 1: ê²½ê³  ë©”ì‹œì§€ í™•ì¸
- [ ] í…ŒìŠ¤íŠ¸ 2: ìƒì„±ëœ ëª…ì„¸ì„œ í™•ì¸
- [ ] í…ŒìŠ¤íŠ¸ 3: Python ëª¨ë¸ ê²€ì¦
- [ ] Git commit

---

## ğŸ¯ ì™„ë£Œ ê¸°ì¤€

1. âœ… ê²½ê³  ë©”ì‹œì§€ ì‚¬ë¼ì§
2. âœ… ê¸°ì¡´ ê¸°ëŠ¥ ì •ìƒ ì‘ë™ (ëª…ì„¸ì„œ ìƒì„±)
3. âœ… í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ì •ë³´ ì •ìƒ í‘œì‹œ

---

## ğŸ“ ì‘ì—… ë¡œê·¸

### ì‹œì‘ ì‹œê°„
- 2025-10-20 20:45:00

### ì¢…ë£Œ ì‹œê°„
- (ì‘ì—… ì™„ë£Œ í›„ ê¸°ë¡)

### ì‹¤ì œ ì†Œìš” ì‹œê°„
- (ì‘ì—… ì™„ë£Œ í›„ ê¸°ë¡)

### ì´ìŠˆ/íŠ¹ì´ì‚¬í•­
- (ì‘ì—… ì¤‘ ë°œê²¬ëœ ì´ìŠˆ ê¸°ë¡)
